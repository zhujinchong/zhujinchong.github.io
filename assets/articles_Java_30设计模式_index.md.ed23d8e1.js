import{_ as s,o as n,c as a,Q as e}from"./chunks/framework.2516552c.js";const l="/assets/5-200Z10944153K.19b8b41f.png",p="/assets/3-1Q1121P6195T.0408bf56.gif",o="/assets/3-1Q1121PA2Y5.9974bba5.gif",t="/assets/image-20210409163011375.a3cb9ec7.png",c="/assets/image-20210425205303365.20c627ae.png",r="/assets/image-20210425205523458.64daf98d.png",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAS0AAAB6CAYAAADqHwUVAAALiElEQVR4nO3dz2vbaBoH8G+X+ROmxIWpnYPnkLAtBkPZbjEsTd5jRC5hLw0l5yD5sBgSci4N+GSLnEPwXEoOad4cTcuCyc4SxsQkS3IYH5J0IfJ2/gftQZYtOZZiO3bk1/5+oFDr5+NXbx69kvXqfWLbtg0iIkX8KeoAiIj6waRFREph0iIipTBpEZFSmLSISClMWkSklB+iDoB6VYMpcpCtz8/wDLe47brsLF7gCucBW/rrX4B//Ttg5p8TwH+uu89L/g0/1/+J37vOVDmeeei/FKDNBMRAY4VJSyka8mUdqUhj2Ip073c9NB4L0vg4lEjocfDykIiUwqRFREph0iIipTBpKaOOM5yhHnUYE+c7zq+ucP5H1HFQr5i0iEgp/PVQGUm8xC2SUYcxcZ7ixews8GPUcVCv2NIiIqUwaZFfQyIrBESx5nyumhBCQAiB7Gerr03VigJCmKiNIEyaXkxa5DejobCtAUe7kA0AaR3lch7aUh6F5Vhfm0oZZeSXRhMmTS8mLepqfn0B1x8kurat3NaYEBAi6yQ3l6dl1mqtdZvXuR5Rj5i0KMArrLz9gv1q5/QazHfXWCuXUS6XUS6v4fpd8xKwIZHdS6DUnFeK7yJ35FnPM8+3HlEf+OshBYotrwGGhJWOtydWK8C2t/9jCvp2BWYViH27xsKWjlhr/U3oX/edD40b1C9NrArTv5OqjlR6tN+DJguTFoVIQX9fgVmN379oD5Lrpb7vixF14uUhhUuvIHG8234SP50Bjv0XdbVjIJMGYq8T+PLJM6+6D/Oy+f+ZV0h83eflID0YW1rk15DIbkhcQELc5FE2UtDeJGEeuwuksBLPQoiL1irz6yUUAGBGw6Z33pwOfclEzkigVNSgbSWQFQKeNfkeK+rbE457qIoaTFFBJvL3aU2a5vu0tpg8VcHLQ2Www/RosMO0api0iEgpvKelDHaYHg12mFYNW1pEpBQmLSJSCpMWESmFSYuIlMKkRURK4a+HSpHICXeMaZVHdB63eOahB+yexg+fiCcipfDykIiUwqRFREph0iIipTBpEZFSmLSISClMWkSkFCYtIlIKkxYRKYVJi0bAgiwGDPRK9EBMWjR81X2YR2aXgV6JHo5Ji4bMgtxz+kfKPba2aPiYtGi4vGMdXrK1RcPHpEVD1G5ludjaomFj0qLh8bayXGxt0ZAxadGQ3G1lueSGidojR0OTi+/TIiKlsKVFI1CDKdi6otFg0iIipTBpEZFSmLSISClMWkSkFCYtIlIKkxYRKYVJi4iUMvEPl1qfs1jduWhPCBuxeOYZ0Og+JnH4aMbjPoIy45maeJbyKBupgIUnw1QkrY/YRGE5FnUoU6QGU1SQKeuY7D+fMVM1IY4zE5+0eHlIREph0iIipTBpEZFSJj5pfT+7wtXZ96jDmDJ1nOEM9ajDmDa/nwHnk1/qE5+0iGiy/BB1AKP29OUsZvE06jCmTBIvcYtk1GFMm59fAv+b/FJnS4uIlMKkRURKYdIiIqUwaRGRUpi0iEgpTFpEpBQmLSJSCpMWESmFSYuIlMKkRURKYdIiIqUwaRGRUib+dctENFnY0iIipTBpEZFSmLSISClMWkSkFCYtIlLKAK9btiCNVZiX7SkDj8g7biM6j0M8QSMEV02IDfn48XiNQ/n0vM9+RnSeh/5LAdrM3SX7GqF8HEaYVioeDfkBBvQd8B3xwQd5uLZGvYM+jTieqglxHDL/TkKbsvIZyT4tSONj6BLz66U+RijnMQnnxuOMQj4IXh4SkVKYtIhIKUxaRKSUAZLWd5xfXeH8j+EHM/XCRgiektGDH194feYI5aMy+CjkbGkRkVIG+PXwKV7MzgI/Dj+YqRc2QvCUjB78+MLrM0coH5XBRyFnS4uIlDKkpFWDKQREx7/sZ6s534I0OqeNoYZEVgiIYs35XDW7fJfeWJ+zECIL2RhBnL3wxN79mAybe4xNOKXnqROGRF97bR6Hsa4r3vI1JGqfzeiO9UAUPl52327tQ92wD62OydahXTy4Df4cNC0qvxXt4m/dpy8uer/fqV0snA60i9uD4t1yuiemxaB9hc0LWN44uLWd41W0T33THiio7OxTu7i46NvHaaG57349Wl0JqM/u3APjbplZh7ahH9qtqXfqzLgJqsNRHq9Tu7g42L4GfCI+TA1mEdANDfpyL8t3dAtqPfVdgylyqC9pwJEE1vNY+JqDeel5Gt/XtcX7lL5/3QvfdoFaUSB3BAAS7tradhl6urml9QVcf5CwihruPAfdkMi+M51tdvYM8M6b05F/21EuItfaX39PWQ8graOQBuA9Z7amhcfjls/8egmF1yfN7+R0ucA9ZYc5HQs3HyEb3XpM+PfpW89XD+ahby941guqI9GofbrGWlFv1420jnLZs0DXOhJWnzeBD6swkxq0Iwm5lEceOeSOvGUUdLyaZeOuCwBzOkpu3fX8jcij5sre8lPxePWf54JbWsbior24uBjcIuiSjW8PDN9Z23dmsw5to5mNTwuLznKtbZzaRe/ZrjNze9a1bds+LXTEHNLSMg5uPXF5z1KdZwfv5455HWffzv23vk/HvofW0mrxtLQ87oun/bnL+mEtLf3QvrUObaMZa/vM3Vlv/J/9+/e3AELryIP129LqXp5tIXXkvvrcrC/tfbbrXvjxaq/rxuw/PiEtrciO15i0tJLrJRSWLZjF3texbi4gdwSkd+LcCaxl50yRXF+B0+7SkEkDcO8bNG5QvzSxKkz/Bqs6Umk3npVWZ8xYHKj8F0CP/SVjy2uAIWGl455tV4BtbwfPFPTtCswqkELHvLSO/FIWN863xE39AuY7AX+0NejpKFoM98eTMkq4MQTEhnOG1frZ/IyGNWQhGwW0Sq9xguu3m9Bb5R+DtrUA81cLWLZQQd5zFk9B39aQ/daM9p46MlbC6shPIfUZAJbWoM0AFpJYeO20ohw91J/mugAQe55E/ZsFpHssHcWO1wguD1PQjX6WH6ynN+AmyVFV2xT09xWY1fj9i/Yi6Wmyj4Oe4tGgLcnQJYKkjDVUijUMp/QGryPDF0M8WcdNA0iN/IUBHiOuPyodrxE+8lCD2cOvEKk3wO4gvzrMvELi637zl48Hakhku8WaXkHieLf91G46Axz791g7hnPGTGeAPc82GhK77j0ExPAq/gX71WEEOwz3xVODKVZx/V6HbpSQ2BMwg5YNKjuksBKvYNctvJlXSNyc+Jazfr1G4nUMQAoZ7Hp+fbMg99rJcuA6MiKpvy/gyydvPbAgjeavcGF1ZGDDrD8WpNHtV211jteQWlo1mO9MSAByxzN5TscKcOddUHIH7ZuFaR1rxwJCeNZbyqNsoLVNPC8jA4mckUBpC6jvrMJ8Xoa+lUBWCLTfduS56elZV4fZfCdSFgn3xnk6AwgBZ7fOmSHWkMhuSFxAQtw4Nw+1N0mYrdfFpLASz0IIzx7XSyg05+nvKxCtL6JBX3e+Q7ysI7W8iUTzcsu37ihvxnvLXUjf/mKB8QDScG6+zn+zgJ9O8OUSuNi4p+xgOetdAlJcO2fa5QySO+7rR2LQ3lx7ygfOcW7+WJMy1lBpbRPQ1nXAPc6BdSSitteMhs2OetC+hA6qI7XQ+vyPI+DsBqjHS9hEvVlvMsBRDtl4CYX7jtels27h9UmrDjtl58SUQbv8tO0y9BmFj1f/t8HCb1zSA4zkRjyFG+CRBxqCwW/Es8P0OGGH6Qiww3Q02GGaiKYEO0yPE3aYjgA7TEeDHaaJaEowaRGRUpi0iEgpTFpEpBQmLSJSyoBPxPs7b07MiMXjEM9SJmBBAEc5CLdr0LSWT8/77HOE6YDdA8DFziqE29ND6RGdxy0eDSG1PdAT27btAdYjIooELw+JSClMWkSkFCYtIlIKkxYRKYVJi4iUwqRFREph0iIipTBpEZFSmLSISCn/B/iSsqMLTM7WAAAAAElFTkSuQmCC",y="/assets/3-1Q115093011523.1b9ec098.gif",d="/assets/3-1Q115093255227.60e64ae8.gif",u="/assets/image-20210427161157260.a7517ba4.png",E="/assets/image-20210427161313960.8837c2ab.png",g="/assets/image-20210427161339723.9f669fd5.png",b="/assets/3-1Q119130413927.8030d11a.gif",m="/assets/3-1Q11910135Y25.f387e4eb.gif",D=JSON.parse('{"title":"简介","description":"","frontmatter":{},"headers":[],"relativePath":"articles/Java/30设计模式/index.md","filePath":"articles/Java/30设计模式/index.md","lastUpdated":1698149129000}'),h={name:"articles/Java/30设计模式/index.md"},v=e('<h1 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h1><p>设计模式，即Design Patterns，是指在软件设计中，被反复使用的一种代码设计经验。使用设计模式的目的是为了可重用代码，提高代码的可扩展性和可维护性。</p><p>设计模式这个术语是上个世纪90年代由Erich Gamma、Richard Helm、Raplh Johnson和Jonhn Vlissides四个人总结提炼出来的，并且写了一本<a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank" rel="noreferrer">Design Patterns</a>的书。这四人也被称为四人帮（GoF）。</p><p>为什么要使用设计模式？根本原因还为了提高代码的可重用性、代码的可读性和代码的可靠性。设计模式主要是基于OOP编程提炼的，它基于以下几个原则：</p><ul><li>开闭原则：由Bertrand Meyer提出的开闭原则（Open Closed Principle）是指，软件应该对扩展开放，而对修改关闭。这里的意思是在增加新功能的时候，能不改代码就尽量不要改，如果只增加代码就完成了新功能，那是最好的。</li><li>里氏替换原则：里氏替换原则是Barbara Liskov提出的，这是一种面向对象的设计原则，即如果我们调用一个父类的方法可以成功，那么替换成子类调用也应该完全可以运行。</li></ul><p>设计模式把一些常用的设计思想提炼出一个个模式，然后给每个模式命名，这样在使用的时候更方便交流。GoF把23个常用模式分为三类。</p><p>根据目的来分：</p><ul><li>创建型模式：把对象的创建和使用相分离，这样使得两者能相对独立地变换。</li><li>结构型模式：如何组合各种对象以便获得更好、更灵活的结构。虽然面向对象的继承机制提供了最基本的子类扩展父类的功能，但结构型模式不仅仅简单地使用继承，而更多地通过组合与运行期的动态组合来实现更灵活的功能。</li><li>行为型模式：用于描述类或对象之间怎样相互协作共同完成单个对象都无法单独完成的任务，以及怎样分配职责。</li></ul><h1 id="uml" tabindex="-1">UML <a class="header-anchor" href="#uml" aria-label="Permalink to &quot;UML&quot;">​</a></h1><p>UML（Unified Modeling Language，统一建模语言）是用来设计软件蓝图的可视化建模语言，是一种为面向对象系统的产品进行说明、可视化和编制文档的标准语言，独立于任何一种具体的程序设计语言。 它的特点是简单、统一、图形化、能表达软件设计中的动态与静态信息。</p><p>UML 建模的核心是模型，模型是现实的简化、真实系统的抽象。UML 提供了系统的设计蓝图。当给软件系统建模时，需要采用通用的符号语言，这种描述模型所使用的语言被称为建模语言。在 UML 中，所有的描述由事物、关系和图这些构件组成。下图完整地描述了所有构件的关系。</p><p><img src="'+l+'" alt="UML基本构件图"></p><p>事物：本文主要用到类、接口</p><p>图：本文只讲类图</p><p>关系：类图中用到依赖关系、关联关系、聚合关系、组合关系、泛化关系和实现关系</p><h1 id="uml类图和类图之间的关系" tabindex="-1">UML类图和类图之间的关系 <a class="header-anchor" href="#uml类图和类图之间的关系" aria-label="Permalink to &quot;UML类图和类图之间的关系&quot;">​</a></h1><p>类图中，四种作用域（元素可见性）public private protected friendly分别用符号<code>+-#~</code>表示。</p><p>如下图Graph是一个接口，用圆圈来表示，有两个实现类，以及一个访问类。</p><ul><li>类中的字段和方法返回值的类型非必须；</li><li>抽象类或抽象方法要用斜体；</li><li>静态类或静态方法要有下划线；</li></ul><p><img src="'+p+'" alt="“计算长方形和圆形的周长与面积”的类图"></p><p>先介绍这一种吧：依赖关系是一种使用关系，从使用类指向被依赖类：</p><p><img src="'+o+`" alt="依赖关系的实例"></p><h1 id="创建型-工厂方法factory" tabindex="-1">创建型-工厂方法Factory <a class="header-anchor" href="#创建型-工厂方法factory" aria-label="Permalink to &quot;创建型-工厂方法Factory&quot;">​</a></h1><p>目的：使创建对象和使用对象分离；</p><p>实现步骤：</p><ol><li><p>创建工厂接口；</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface NumberFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    Number parse(String s);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface NumberFactory {</span></span>
<span class="line"><span style="color:#24292e;">    Number parse(String s);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>编写工厂实现类；</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class NumberFactoryImpl implements NumberFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public Number parse(String s) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new BigDecimal(s);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class NumberFactoryImpl implements NumberFactory {</span></span>
<span class="line"><span style="color:#24292e;">    public Number parse(String s) {</span></span>
<span class="line"><span style="color:#24292e;">        return new BigDecimal(s);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>在工厂接口中定义创建对象的静态方法</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface NumberFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 创建方法:</span></span>
<span class="line"><span style="color:#e1e4e8;">    Number parse(String s);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    // 获取工厂实例:</span></span>
<span class="line"><span style="color:#e1e4e8;">    static NumberFactory getFactory() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return impl;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    static NumberFactory impl = new NumberFactoryImpl();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface NumberFactory {</span></span>
<span class="line"><span style="color:#24292e;">    // 创建方法:</span></span>
<span class="line"><span style="color:#24292e;">    Number parse(String s);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    // 获取工厂实例:</span></span>
<span class="line"><span style="color:#24292e;">    static NumberFactory getFactory() {</span></span>
<span class="line"><span style="color:#24292e;">        return impl;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    static NumberFactory impl = new NumberFactoryImpl();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>客户可以这么来用：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">NumberFactory factory = NumberFactory.getFactory();</span></span>
<span class="line"><span style="color:#e1e4e8;">Number result = factory.parse(&quot;123.456&quot;);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">NumberFactory factory = NumberFactory.getFactory();</span></span>
<span class="line"><span style="color:#24292e;">Number result = factory.parse(&quot;123.456&quot;);</span></span></code></pre></div></li></ol><h1 id="创建型-静态工厂方法" tabindex="-1">创建型-静态工厂方法 <a class="header-anchor" href="#创建型-静态工厂方法" aria-label="Permalink to &quot;创建型-静态工厂方法&quot;">​</a></h1><p>工厂方法麻烦，可以直接在类中定义一个静态方法，来返回对象，如</p><p><code>Integer n = Integer.valueOf(100);</code>，这说明Integer既是工厂，也是产品（对象）；它的源代码如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public final class Integer {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span></span>
<span class="line"><span style="color:#e1e4e8;">            return IntegerCache.cache[i + (-IntegerCache.low)];</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public final class Integer {</span></span>
<span class="line"><span style="color:#24292e;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#24292e;">        if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span></span>
<span class="line"><span style="color:#24292e;">            return IntegerCache.cache[i + (-IntegerCache.low)];</span></span>
<span class="line"><span style="color:#24292e;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>有时候返回新的实例，有时候返回缓存中的实例。这里利用缓存是结构型-享元的思想，如果不利用缓存，可以这样写：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public final class Integer {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public final class Integer {</span></span>
<span class="line"><span style="color:#24292e;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#24292e;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="创建型-抽象工厂" tabindex="-1">创建型-抽象工厂 <a class="header-anchor" href="#创建型-抽象工厂" aria-label="Permalink to &quot;创建型-抽象工厂&quot;">​</a></h1><p>抽象工厂相比工厂方法解决的问题更复杂，不但工厂要抽象，产品也是抽象的，因此，这个抽象工厂对应多个实际工厂，每个实际工厂负责创建多个实际产品。</p><p><img src="`+t+`" alt="image-20210409163011375"></p><p>假设我们为用户提供一个Markdown文本转换为HTML和Word的服务。</p><ol><li><p>定义工厂接口</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface AbstractFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 创建Html文档:</span></span>
<span class="line"><span style="color:#e1e4e8;">    HtmlDocument createHtml(String md);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 创建Word文档:</span></span>
<span class="line"><span style="color:#e1e4e8;">    WordDocument createWord(String md);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface AbstractFactory {</span></span>
<span class="line"><span style="color:#24292e;">    // 创建Html文档:</span></span>
<span class="line"><span style="color:#24292e;">    HtmlDocument createHtml(String md);</span></span>
<span class="line"><span style="color:#24292e;">    // 创建Word文档:</span></span>
<span class="line"><span style="color:#24292e;">    WordDocument createWord(String md);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>两个产品我们不知道如何实现的，所以定义接口：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// Html文档接口:</span></span>
<span class="line"><span style="color:#e1e4e8;">public interface HtmlDocument {</span></span>
<span class="line"><span style="color:#e1e4e8;">    String toHtml();</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">// Word文档接口:</span></span>
<span class="line"><span style="color:#e1e4e8;">public interface WordDocument {</span></span>
<span class="line"><span style="color:#e1e4e8;">    String toWord();</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// Html文档接口:</span></span>
<span class="line"><span style="color:#24292e;">public interface HtmlDocument {</span></span>
<span class="line"><span style="color:#24292e;">    String toHtml();</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">// Word文档接口:</span></span>
<span class="line"><span style="color:#24292e;">public interface WordDocument {</span></span>
<span class="line"><span style="color:#24292e;">    String toWord();</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>现有一家供应商FastDoc，他是如何实现产品的呢？</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class FastHtmlDocument implements HtmlDocument {</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">public class FastWordDocument implements WordDocument {</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">public class FastFactory implements AbstractFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public HtmlDocument createHtml(String md) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new FastHtmlDocument(md);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public WordDocument createWord(String md) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new FastWordDocument(md);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class FastHtmlDocument implements HtmlDocument {</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">public class FastWordDocument implements WordDocument {</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">public class FastFactory implements AbstractFactory {</span></span>
<span class="line"><span style="color:#24292e;">    public HtmlDocument createHtml(String md) {</span></span>
<span class="line"><span style="color:#24292e;">        return new FastHtmlDocument(md);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public WordDocument createWord(String md) {</span></span>
<span class="line"><span style="color:#24292e;">        return new FastWordDocument(md);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>客户端，我们可以这么来用：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">AbstractFactory factory = new FastFactory();</span></span>
<span class="line"><span style="color:#e1e4e8;">HtmlDocument html = factory.createHtml(&quot;# Hello\\nHello, world!&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">html.toHtml();</span></span>
<span class="line"><span style="color:#e1e4e8;">WordDocument word = factory.createWord(&quot;#Hello\\nHello, world!&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">word.toWord();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">AbstractFactory factory = new FastFactory();</span></span>
<span class="line"><span style="color:#24292e;">HtmlDocument html = factory.createHtml(&quot;# Hello\\nHello, world!&quot;);</span></span>
<span class="line"><span style="color:#24292e;">html.toHtml();</span></span>
<span class="line"><span style="color:#24292e;">WordDocument word = factory.createWord(&quot;#Hello\\nHello, world!&quot;);</span></span>
<span class="line"><span style="color:#24292e;">word.toWord();</span></span></code></pre></div></li><li><p>注意到，客户端只使用了<code>new FastFactory()</code>，并没有<code>new HtmlDocment()</code>；如果我们将<code>new FastFactory()</code>放在抽象工厂里，那么实际工厂也就屏蔽了：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface AbstractFactory {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static AbstractFactory createFactory(String name) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (name.equalsIgnoreCase(&quot;fast&quot;)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">            return new FastFactory();</span></span>
<span class="line"><span style="color:#e1e4e8;">        }</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface AbstractFactory {</span></span>
<span class="line"><span style="color:#24292e;">    public static AbstractFactory createFactory(String name) {</span></span>
<span class="line"><span style="color:#24292e;">        if (name.equalsIgnoreCase(&quot;fast&quot;)) {</span></span>
<span class="line"><span style="color:#24292e;">            return new FastFactory();</span></span>
<span class="line"><span style="color:#24292e;">        }</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li></ol><h1 id="创建型-生成器builder" tabindex="-1">创建型-生成器Builder <a class="header-anchor" href="#创建型-生成器builder" aria-label="Permalink to &quot;创建型-生成器Builder&quot;">​</a></h1><p>有时候创建一个对象比较复杂，可以分步创建，就像机器上的零件，比如Markdown转HTML:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class HtmlBuilder {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private HeadingBuilder headingBuilder = new HeadingBuilder();</span></span>
<span class="line"><span style="color:#e1e4e8;">    private HrBuilder hrBuilder = new HrBuilder();</span></span>
<span class="line"><span style="color:#e1e4e8;">    private ParagraphBuilder paragraphBuilder = new ParagraphBuilder();</span></span>
<span class="line"><span style="color:#e1e4e8;">    private QuoteBuilder quoteBuilder = new QuoteBuilder();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public String toHtml(String markdown) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        StringBuilder buffer = new StringBuilder();</span></span>
<span class="line"><span style="color:#e1e4e8;">        markdown.lines().forEach(line -&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">            if (line.startsWith(&quot;#&quot;)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">                buffer.append(headingBuilder.buildHeading(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">            } else if (line.startsWith(&quot;&gt;&quot;)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">                buffer.append(quoteBuilder.buildQuote(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">            } else if (line.startsWith(&quot;---&quot;)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">                buffer.append(hrBuilder.buildHr(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">            } else {</span></span>
<span class="line"><span style="color:#e1e4e8;">                buffer.append(paragraphBuilder.buildParagraph(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">            }</span></span>
<span class="line"><span style="color:#e1e4e8;">        });</span></span>
<span class="line"><span style="color:#e1e4e8;">        return buffer.toString();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class HtmlBuilder {</span></span>
<span class="line"><span style="color:#24292e;">    private HeadingBuilder headingBuilder = new HeadingBuilder();</span></span>
<span class="line"><span style="color:#24292e;">    private HrBuilder hrBuilder = new HrBuilder();</span></span>
<span class="line"><span style="color:#24292e;">    private ParagraphBuilder paragraphBuilder = new ParagraphBuilder();</span></span>
<span class="line"><span style="color:#24292e;">    private QuoteBuilder quoteBuilder = new QuoteBuilder();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public String toHtml(String markdown) {</span></span>
<span class="line"><span style="color:#24292e;">        StringBuilder buffer = new StringBuilder();</span></span>
<span class="line"><span style="color:#24292e;">        markdown.lines().forEach(line -&gt; {</span></span>
<span class="line"><span style="color:#24292e;">            if (line.startsWith(&quot;#&quot;)) {</span></span>
<span class="line"><span style="color:#24292e;">                buffer.append(headingBuilder.buildHeading(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#24292e;">            } else if (line.startsWith(&quot;&gt;&quot;)) {</span></span>
<span class="line"><span style="color:#24292e;">                buffer.append(quoteBuilder.buildQuote(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#24292e;">            } else if (line.startsWith(&quot;---&quot;)) {</span></span>
<span class="line"><span style="color:#24292e;">                buffer.append(hrBuilder.buildHr(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#24292e;">            } else {</span></span>
<span class="line"><span style="color:#24292e;">                buffer.append(paragraphBuilder.buildParagraph(line)).append(&#39;\\n&#39;);</span></span>
<span class="line"><span style="color:#24292e;">            }</span></span>
<span class="line"><span style="color:#24292e;">        });</span></span>
<span class="line"><span style="color:#24292e;">        return buffer.toString();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>很多时候，我们可以简化Builder模式，以链式调用的方式来创建对象。例如：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">String url = URLBuilder.builder() // 创建Builder</span></span>
<span class="line"><span style="color:#e1e4e8;">        .setDomain(&quot;www.liaoxuefeng.com&quot;) // 设置domain</span></span>
<span class="line"><span style="color:#e1e4e8;">        .setScheme(&quot;https&quot;) // 设置scheme</span></span>
<span class="line"><span style="color:#e1e4e8;">        .setPath(&quot;/&quot;) // 设置路径</span></span>
<span class="line"><span style="color:#e1e4e8;">        .setQuery(Map.of(&quot;a&quot;, &quot;123&quot;, &quot;q&quot;, &quot;K&amp;R&quot;)) // 设置query</span></span>
<span class="line"><span style="color:#e1e4e8;">        .build(); // 完成build</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">String url = URLBuilder.builder() // 创建Builder</span></span>
<span class="line"><span style="color:#24292e;">        .setDomain(&quot;www.liaoxuefeng.com&quot;) // 设置domain</span></span>
<span class="line"><span style="color:#24292e;">        .setScheme(&quot;https&quot;) // 设置scheme</span></span>
<span class="line"><span style="color:#24292e;">        .setPath(&quot;/&quot;) // 设置路径</span></span>
<span class="line"><span style="color:#24292e;">        .setQuery(Map.of(&quot;a&quot;, &quot;123&quot;, &quot;q&quot;, &quot;K&amp;R&quot;)) // 设置query</span></span>
<span class="line"><span style="color:#24292e;">        .build(); // 完成build</span></span></code></pre></div><h1 id="创建型-原型模式prototype" tabindex="-1">创建型-原型模式Prototype <a class="header-anchor" href="#创建型-原型模式prototype" aria-label="Permalink to &quot;创建型-原型模式Prototype&quot;">​</a></h1><p>原型模式是根据一个现有对象实例复制出一个新的实例，复制出的类型和属性与原实例相同。实现如下：</p><blockquote><p>Java的<code>Object</code>提供了一个<code>clone()</code>方法，需要重写，并且返回值是<code>Object</code>，还需要转型，用起来不方便。</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Student {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private int id;</span></span>
<span class="line"><span style="color:#e1e4e8;">    private String name;</span></span>
<span class="line"><span style="color:#e1e4e8;">    private int score;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public Student copy() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        Student std = new Student();</span></span>
<span class="line"><span style="color:#e1e4e8;">        std.id = this.id;</span></span>
<span class="line"><span style="color:#e1e4e8;">        std.name = this.name;</span></span>
<span class="line"><span style="color:#e1e4e8;">        std.score = this.score;</span></span>
<span class="line"><span style="color:#e1e4e8;">        return std;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Student {</span></span>
<span class="line"><span style="color:#24292e;">    private int id;</span></span>
<span class="line"><span style="color:#24292e;">    private String name;</span></span>
<span class="line"><span style="color:#24292e;">    private int score;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public Student copy() {</span></span>
<span class="line"><span style="color:#24292e;">        Student std = new Student();</span></span>
<span class="line"><span style="color:#24292e;">        std.id = this.id;</span></span>
<span class="line"><span style="color:#24292e;">        std.name = this.name;</span></span>
<span class="line"><span style="color:#24292e;">        std.score = this.score;</span></span>
<span class="line"><span style="color:#24292e;">        return std;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>但是原型模式应用不是很广泛，因为很多实例会持有类似文件、Socket这样的资源，而这些资源是无法复制给另一个对象共享的，只有存储简单类型的“值”对象可以复制。</p><h1 id="创建型-单例模式singleton" tabindex="-1">创建型-单例模式Singleton <a class="header-anchor" href="#创建型-单例模式singleton" aria-label="Permalink to &quot;创建型-单例模式Singleton&quot;">​</a></h1><p>Singleton为了保证在一个进程中，某个类有且仅有一个实例。</p><p>首先保证用户不能调用<code>new Xxx()</code>，所以要自己创建；保证只有一个实例，所以用静态字段。</p><p>饿汉式：（多线程安全）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Singleton {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 静态字段引用唯一实例:</span></span>
<span class="line"><span style="color:#e1e4e8;">    private static final Singleton INSTANCE = new Singleton();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    // private构造方法保证外部无法实例化:</span></span>
<span class="line"><span style="color:#e1e4e8;">    private Singleton() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static Singleton getInstance() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    	return INSTANCE;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Singleton s = Singleton.getInstance();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Singleton {</span></span>
<span class="line"><span style="color:#24292e;">    // 静态字段引用唯一实例:</span></span>
<span class="line"><span style="color:#24292e;">    private static final Singleton INSTANCE = new Singleton();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    // private构造方法保证外部无法实例化:</span></span>
<span class="line"><span style="color:#24292e;">    private Singleton() {</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public static Singleton getInstance() {</span></span>
<span class="line"><span style="color:#24292e;">    	return INSTANCE;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Singleton s = Singleton.getInstance();</span></span></code></pre></div><p>懒汉式：（多线程安全，加锁才可以保证单例）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Singleton {  </span></span>
<span class="line"><span style="color:#e1e4e8;">    private static Singleton instance;  </span></span>
<span class="line"><span style="color:#e1e4e8;">    private Singleton (){}  </span></span>
<span class="line"><span style="color:#e1e4e8;">    public static synchronized Singleton getInstance() {  </span></span>
<span class="line"><span style="color:#e1e4e8;">    if (instance == null) {  </span></span>
<span class="line"><span style="color:#e1e4e8;">        instance = new Singleton();  </span></span>
<span class="line"><span style="color:#e1e4e8;">    }  </span></span>
<span class="line"><span style="color:#e1e4e8;">    return instance;  </span></span>
<span class="line"><span style="color:#e1e4e8;">    }  </span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Singleton {  </span></span>
<span class="line"><span style="color:#24292e;">    private static Singleton instance;  </span></span>
<span class="line"><span style="color:#24292e;">    private Singleton (){}  </span></span>
<span class="line"><span style="color:#24292e;">    public static synchronized Singleton getInstance() {  </span></span>
<span class="line"><span style="color:#24292e;">    if (instance == null) {  </span></span>
<span class="line"><span style="color:#24292e;">        instance = new Singleton();  </span></span>
<span class="line"><span style="color:#24292e;">    }  </span></span>
<span class="line"><span style="color:#24292e;">    return instance;  </span></span>
<span class="line"><span style="color:#24292e;">    }  </span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>懒汉式：（多线程不安全）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Singleton {  </span></span>
<span class="line"><span style="color:#e1e4e8;">    private static Singleton instance;  </span></span>
<span class="line"><span style="color:#e1e4e8;">    private Singleton (){}  </span></span>
<span class="line"><span style="color:#e1e4e8;">    public static Singleton getInstance() {  </span></span>
<span class="line"><span style="color:#e1e4e8;">    if (instance == null) {  </span></span>
<span class="line"><span style="color:#e1e4e8;">        instance = new Singleton();  </span></span>
<span class="line"><span style="color:#e1e4e8;">    }  </span></span>
<span class="line"><span style="color:#e1e4e8;">    return instance;  </span></span>
<span class="line"><span style="color:#e1e4e8;">    }  </span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Singleton {  </span></span>
<span class="line"><span style="color:#24292e;">    private static Singleton instance;  </span></span>
<span class="line"><span style="color:#24292e;">    private Singleton (){}  </span></span>
<span class="line"><span style="color:#24292e;">    public static Singleton getInstance() {  </span></span>
<span class="line"><span style="color:#24292e;">    if (instance == null) {  </span></span>
<span class="line"><span style="color:#24292e;">        instance = new Singleton();  </span></span>
<span class="line"><span style="color:#24292e;">    }  </span></span>
<span class="line"><span style="color:#24292e;">    return instance;  </span></span>
<span class="line"><span style="color:#24292e;">    }  </span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="结构型-适配器adapter" tabindex="-1">结构型-适配器Adapter <a class="header-anchor" href="#结构型-适配器adapter" aria-label="Permalink to &quot;结构型-适配器Adapter&quot;">​</a></h1><p>也称Wrapper，指如果一个接口需要B接口，但是待传入的对象却是A接口，怎么办？Adapter将A接口转换为B接口。</p><p>实现：编写Adapter实际上就是编写一个实现了B接口，并且内部持有A接口的类：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public BAdapter implements B {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private A a;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public BAdapter(A a) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.a = a;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void b() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        a.a();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public BAdapter implements B {</span></span>
<span class="line"><span style="color:#24292e;">    private A a;</span></span>
<span class="line"><span style="color:#24292e;">    public BAdapter(A a) {</span></span>
<span class="line"><span style="color:#24292e;">        this.a = a;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public void b() {</span></span>
<span class="line"><span style="color:#24292e;">        a.a();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="结构型-桥接" tabindex="-1">结构型-桥接 <a class="header-anchor" href="#结构型-桥接" aria-label="Permalink to &quot;结构型-桥接&quot;">​</a></h1><p>假设有三个品牌的汽车BigCar、TinyCar、BossCar，每个品牌有可以选择燃油 、纯电和混合动力。传统继承方法一共3个抽象类和9个实现类。如果再新增一个核动力引擎，那么还需要新增3个实现类。</p><p><img src="`+c+'" alt="image-20210425205303365"></p><p>桥接模式则将车和引擎都抽象，并将两者再结合起来，如下图：</p><p><img src="'+r+`" alt="image-20210425205523458"></p><p>代码：</p><ol><li><p>抽象汽车、接口引擎：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public abstract class Car {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 引用Engine:</span></span>
<span class="line"><span style="color:#e1e4e8;">    protected Engine engine;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public Car(Engine engine) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.engine = engine;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public abstract void drive();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">public interface Engine {</span></span>
<span class="line"><span style="color:#e1e4e8;">    void start();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public abstract class Car {</span></span>
<span class="line"><span style="color:#24292e;">    // 引用Engine:</span></span>
<span class="line"><span style="color:#24292e;">    protected Engine engine;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public Car(Engine engine) {</span></span>
<span class="line"><span style="color:#24292e;">        this.engine = engine;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public abstract void drive();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">public interface Engine {</span></span>
<span class="line"><span style="color:#24292e;">    void start();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>两者结合</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public abstract class RefinedCar extends Car {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public RefinedCar(Engine engine) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        super(engine);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public void drive() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.engine.start();</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;Drive &quot; + getBrand() + &quot; car...&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public abstract String getBrand();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public abstract class RefinedCar extends Car {</span></span>
<span class="line"><span style="color:#24292e;">    public RefinedCar(Engine engine) {</span></span>
<span class="line"><span style="color:#24292e;">        super(engine);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public void drive() {</span></span>
<span class="line"><span style="color:#24292e;">        this.engine.start();</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;Drive &quot; + getBrand() + &quot; car...&quot;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public abstract String getBrand();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>品牌车、引擎</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class BossCar extends RefinedCar {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public BossCar(Engine engine) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        super(engine);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public String getBrand() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return &quot;Boss&quot;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">public class HybridEngine implements Engine {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void start() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;Start Hybrid Engine...&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class BossCar extends RefinedCar {</span></span>
<span class="line"><span style="color:#24292e;">    public BossCar(Engine engine) {</span></span>
<span class="line"><span style="color:#24292e;">        super(engine);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public String getBrand() {</span></span>
<span class="line"><span style="color:#24292e;">        return &quot;Boss&quot;;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">public class HybridEngine implements Engine {</span></span>
<span class="line"><span style="color:#24292e;">    public void start() {</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;Start Hybrid Engine...&quot;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>客户</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">RefinedCar car = new BossCar(new HybridEngine());</span></span>
<span class="line"><span style="color:#e1e4e8;">car.drive();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">RefinedCar car = new BossCar(new HybridEngine());</span></span>
<span class="line"><span style="color:#24292e;">car.drive();</span></span></code></pre></div></li></ol><h1 id="结构型-组合composite" tabindex="-1">结构型-组合Composite <a class="header-anchor" href="#结构型-组合composite" aria-label="Permalink to &quot;结构型-组合Composite&quot;">​</a></h1><p>组合模式（Composite）经常用于树形结构，为了简化代码，使用Composite可以把一个叶子节点与一个父节点统一起来处理。</p><p><img src="`+i+`" alt="image-20210425211129465"></p><p>例如，我们定义一个XML文档：</p><ol><li><p>抽象出具有统一性质的Node接口：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface Node {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 添加一个节点为子节点:</span></span>
<span class="line"><span style="color:#e1e4e8;">    Node add(Node node);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 获取子节点:</span></span>
<span class="line"><span style="color:#e1e4e8;">    List&lt;Node&gt; children();</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 输出为XML:</span></span>
<span class="line"><span style="color:#e1e4e8;">    String toXml();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface Node {</span></span>
<span class="line"><span style="color:#24292e;">    // 添加一个节点为子节点:</span></span>
<span class="line"><span style="color:#24292e;">    Node add(Node node);</span></span>
<span class="line"><span style="color:#24292e;">    // 获取子节点:</span></span>
<span class="line"><span style="color:#24292e;">    List&lt;Node&gt; children();</span></span>
<span class="line"><span style="color:#24292e;">    // 输出为XML:</span></span>
<span class="line"><span style="color:#24292e;">    String toXml();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>实现元素节点ElementNode，可以包含多个子节点：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class ElementNode implements Node {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private String name;</span></span>
<span class="line"><span style="color:#e1e4e8;">    private List&lt;Node&gt; list = new ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public ElementNode(String name) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.name = name;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public Node add(Node node) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        list.add(node);</span></span>
<span class="line"><span style="color:#e1e4e8;">        return this;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public List&lt;Node&gt; children() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return list;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public String toXml() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        String start = &quot;&lt;&quot; + name + &quot;&gt;\\n&quot;;</span></span>
<span class="line"><span style="color:#e1e4e8;">        String end = &quot;&lt;/&quot; + name + &quot;&gt;\\n&quot;;</span></span>
<span class="line"><span style="color:#e1e4e8;">        StringJoiner sj = new StringJoiner(&quot;&quot;, start, end);</span></span>
<span class="line"><span style="color:#e1e4e8;">        list.forEach(node -&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">            sj.add(node.toXml() + &quot;\\n&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">        });</span></span>
<span class="line"><span style="color:#e1e4e8;">        return sj.toString();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class ElementNode implements Node {</span></span>
<span class="line"><span style="color:#24292e;">    private String name;</span></span>
<span class="line"><span style="color:#24292e;">    private List&lt;Node&gt; list = new ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public ElementNode(String name) {</span></span>
<span class="line"><span style="color:#24292e;">        this.name = name;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public Node add(Node node) {</span></span>
<span class="line"><span style="color:#24292e;">        list.add(node);</span></span>
<span class="line"><span style="color:#24292e;">        return this;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public List&lt;Node&gt; children() {</span></span>
<span class="line"><span style="color:#24292e;">        return list;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public String toXml() {</span></span>
<span class="line"><span style="color:#24292e;">        String start = &quot;&lt;&quot; + name + &quot;&gt;\\n&quot;;</span></span>
<span class="line"><span style="color:#24292e;">        String end = &quot;&lt;/&quot; + name + &quot;&gt;\\n&quot;;</span></span>
<span class="line"><span style="color:#24292e;">        StringJoiner sj = new StringJoiner(&quot;&quot;, start, end);</span></span>
<span class="line"><span style="color:#24292e;">        list.forEach(node -&gt; {</span></span>
<span class="line"><span style="color:#24292e;">            sj.add(node.toXml() + &quot;\\n&quot;);</span></span>
<span class="line"><span style="color:#24292e;">        });</span></span>
<span class="line"><span style="color:#24292e;">        return sj.toString();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>实现文本节点，不能包含子节点：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class TextNode implements Node {</span></span>
<span class="line"><span style="color:#e1e4e8;">	private String text;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">	public TextNode(String text) {</span></span>
<span class="line"><span style="color:#e1e4e8;">		this.text = text;</span></span>
<span class="line"><span style="color:#e1e4e8;">	}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">	public Node add(Node node) {</span></span>
<span class="line"><span style="color:#e1e4e8;">		throw new UnsupportedOperationException();</span></span>
<span class="line"><span style="color:#e1e4e8;">	}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">	public List&lt;Node&gt; children() {</span></span>
<span class="line"><span style="color:#e1e4e8;">		return List.of();</span></span>
<span class="line"><span style="color:#e1e4e8;">	}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">	public String toXml() {</span></span>
<span class="line"><span style="color:#e1e4e8;">		return text;</span></span>
<span class="line"><span style="color:#e1e4e8;">	}</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class TextNode implements Node {</span></span>
<span class="line"><span style="color:#24292e;">	private String text;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">	public TextNode(String text) {</span></span>
<span class="line"><span style="color:#24292e;">		this.text = text;</span></span>
<span class="line"><span style="color:#24292e;">	}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">	public Node add(Node node) {</span></span>
<span class="line"><span style="color:#24292e;">		throw new UnsupportedOperationException();</span></span>
<span class="line"><span style="color:#24292e;">	}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">	public List&lt;Node&gt; children() {</span></span>
<span class="line"><span style="color:#24292e;">		return List.of();</span></span>
<span class="line"><span style="color:#24292e;">	}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">	public String toXml() {</span></span>
<span class="line"><span style="color:#24292e;">		return text;</span></span>
<span class="line"><span style="color:#24292e;">	}</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>使用：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Node root = new ElementNode(&quot;school&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">root.add(new ElementNode(&quot;classA&quot;)</span></span>
<span class="line"><span style="color:#e1e4e8;">        .add(new TextNode(&quot;Tom&quot;))</span></span>
<span class="line"><span style="color:#e1e4e8;">        .add(new TextNode(&quot;Alice&quot;)));</span></span>
<span class="line"><span style="color:#e1e4e8;">root.add(new ElementNode(&quot;classB&quot;)</span></span>
<span class="line"><span style="color:#e1e4e8;">        .add(new TextNode(&quot;Bob&quot;))</span></span>
<span class="line"><span style="color:#e1e4e8;">        .add(new TextNode(&quot;Grace&quot;)));</span></span>
<span class="line"><span style="color:#e1e4e8;">System.out.println(root.toXml());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Node root = new ElementNode(&quot;school&quot;);</span></span>
<span class="line"><span style="color:#24292e;">root.add(new ElementNode(&quot;classA&quot;)</span></span>
<span class="line"><span style="color:#24292e;">        .add(new TextNode(&quot;Tom&quot;))</span></span>
<span class="line"><span style="color:#24292e;">        .add(new TextNode(&quot;Alice&quot;)));</span></span>
<span class="line"><span style="color:#24292e;">root.add(new ElementNode(&quot;classB&quot;)</span></span>
<span class="line"><span style="color:#24292e;">        .add(new TextNode(&quot;Bob&quot;))</span></span>
<span class="line"><span style="color:#24292e;">        .add(new TextNode(&quot;Grace&quot;)));</span></span>
<span class="line"><span style="color:#24292e;">System.out.println(root.toXml());</span></span></code></pre></div></li></ol><h1 id="结构型-装饰器decorator" tabindex="-1">结构型-装饰器Decorator <a class="header-anchor" href="#结构型-装饰器decorator" aria-label="Permalink to &quot;结构型-装饰器Decorator&quot;">​</a></h1><p>装饰器（Decorator）模式，是一种在运行期动态给某个对象的实例增加功能的方法。</p><p>在Java的IO系统中，就利用了装饰器，<code>InputStream</code>是抽象类，<code>FileInputStream</code>是实现类，如果在<code>FileInputStream</code>上增加功能，不必重新编写，可以利用装饰器模式：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// 创建原始的数据源:</span></span>
<span class="line"><span style="color:#e1e4e8;">InputStream fis = new FileInputStream(&quot;test.gz&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">// 增加缓冲功能:</span></span>
<span class="line"><span style="color:#e1e4e8;">InputStream bis = new BufferedInputStream(fis);</span></span>
<span class="line"><span style="color:#e1e4e8;">// 增加解压缩功能:</span></span>
<span class="line"><span style="color:#e1e4e8;">InputStream gis = new GZIPInputStream(bis);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">// 或者一次性写：</span></span>
<span class="line"><span style="color:#e1e4e8;">InputStream input = new GZIPInputStream(new BufferedInputStream(new FileInputStream(&quot;test.gz&quot;)));</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// 创建原始的数据源:</span></span>
<span class="line"><span style="color:#24292e;">InputStream fis = new FileInputStream(&quot;test.gz&quot;);</span></span>
<span class="line"><span style="color:#24292e;">// 增加缓冲功能:</span></span>
<span class="line"><span style="color:#24292e;">InputStream bis = new BufferedInputStream(fis);</span></span>
<span class="line"><span style="color:#24292e;">// 增加解压缩功能:</span></span>
<span class="line"><span style="color:#24292e;">InputStream gis = new GZIPInputStream(bis);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">// 或者一次性写：</span></span>
<span class="line"><span style="color:#24292e;">InputStream input = new GZIPInputStream(new BufferedInputStream(new FileInputStream(&quot;test.gz&quot;)));</span></span></code></pre></div><p>实际上，装饰器是为了把核心功能和附加功能分开。</p><p>假设我们要渲染HTML文本，如加粗、斜体等，可以利用装饰器：</p><ol><li><p>定义顶层接口：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface TextNode {</span></span>
<span class="line"><span style="color:#e1e4e8;">    void setText(String text);</span></span>
<span class="line"><span style="color:#e1e4e8;">    String getText();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface TextNode {</span></span>
<span class="line"><span style="color:#24292e;">    void setText(String text);</span></span>
<span class="line"><span style="color:#24292e;">    String getText();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>实现核心节点：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class SpanNode implements TextNode {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private String text;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void setText(String text) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.text = text;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public String getText() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return &quot;&lt;span&gt;&quot; + text + &quot;&lt;/span&gt;&quot;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class SpanNode implements TextNode {</span></span>
<span class="line"><span style="color:#24292e;">    private String text;</span></span>
<span class="line"><span style="color:#24292e;">    public void setText(String text) {</span></span>
<span class="line"><span style="color:#24292e;">        this.text = text;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public String getText() {</span></span>
<span class="line"><span style="color:#24292e;">        return &quot;&lt;span&gt;&quot; + text + &quot;&lt;/span&gt;&quot;;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>添加渲染效果：（抽象类+继承）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public abstract class NodeDecorator implements TextNode {</span></span>
<span class="line"><span style="color:#e1e4e8;">    protected final TextNode target;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    protected NodeDecorator(TextNode target) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.target = target;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public void setText(String text) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.target.setText(text);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">public class BoldDecorator extends NodeDecorator {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public BoldDecorator(TextNode target) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        super(target);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public String getText() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return &quot;&lt;b&gt;&quot; + target.getText() + &quot;&lt;/b&gt;&quot;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public abstract class NodeDecorator implements TextNode {</span></span>
<span class="line"><span style="color:#24292e;">    protected final TextNode target;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    protected NodeDecorator(TextNode target) {</span></span>
<span class="line"><span style="color:#24292e;">        this.target = target;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public void setText(String text) {</span></span>
<span class="line"><span style="color:#24292e;">        this.target.setText(text);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">public class BoldDecorator extends NodeDecorator {</span></span>
<span class="line"><span style="color:#24292e;">    public BoldDecorator(TextNode target) {</span></span>
<span class="line"><span style="color:#24292e;">        super(target);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public String getText() {</span></span>
<span class="line"><span style="color:#24292e;">        return &quot;&lt;b&gt;&quot; + target.getText() + &quot;&lt;/b&gt;&quot;;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>客户端使用</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">TextNode nood = new BoldDecorator(new SpanNode());</span></span>
<span class="line"><span style="color:#e1e4e8;">System.out.println(nood.getText());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">TextNode nood = new BoldDecorator(new SpanNode());</span></span>
<span class="line"><span style="color:#24292e;">System.out.println(nood.getText());</span></span></code></pre></div></li></ol><h1 id="结构型-外观facade" tabindex="-1">结构型-外观Facade <a class="header-anchor" href="#结构型-外观facade" aria-label="Permalink to &quot;结构型-外观Facade&quot;">​</a></h1><blockquote><p>为子系统中的一组接口提供一个一致的界面。Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p></blockquote><p>我们以注册公司为例，假设注册公司需要三步：</p><ol><li>向工商局申请公司营业执照；接口<code>AdminOfIndustry </code></li><li>在银行开设账户；接口<code>Bank</code></li><li>在税务局开设纳税号。接口<code>Taxation</code></li></ol><p>上面比较复杂，可以定义一个中间商，我们找中间商一次完成：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Facade {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public Company openCompany(String name) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        Company c = this.admin.register(name);</span></span>
<span class="line"><span style="color:#e1e4e8;">        String bankAccount = this.bank.openAccount(c.getId());</span></span>
<span class="line"><span style="color:#e1e4e8;">        c.setBankAccount(bankAccount);</span></span>
<span class="line"><span style="color:#e1e4e8;">        String taxCode = this.taxation.applyTaxCode(c.getId());</span></span>
<span class="line"><span style="color:#e1e4e8;">        c.setTaxCode(taxCode);</span></span>
<span class="line"><span style="color:#e1e4e8;">        return c;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Facade {</span></span>
<span class="line"><span style="color:#24292e;">    public Company openCompany(String name) {</span></span>
<span class="line"><span style="color:#24292e;">        Company c = this.admin.register(name);</span></span>
<span class="line"><span style="color:#24292e;">        String bankAccount = this.bank.openAccount(c.getId());</span></span>
<span class="line"><span style="color:#24292e;">        c.setBankAccount(bankAccount);</span></span>
<span class="line"><span style="color:#24292e;">        String taxCode = this.taxation.applyTaxCode(c.getId());</span></span>
<span class="line"><span style="color:#24292e;">        c.setTaxCode(taxCode);</span></span>
<span class="line"><span style="color:#24292e;">        return c;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="结构型-享元flyweight" tabindex="-1">结构型-享元Flyweight <a class="header-anchor" href="#结构型-享元flyweight" aria-label="Permalink to &quot;结构型-享元Flyweight&quot;">​</a></h1><p>享元（Flyweight）的核心思想很简单：如果一个对象实例一经创建就不可变，那么反复创建相同的实例就没有必要，直接向调用方返回一个共享的实例就行，这样即节省内存，又可以减少创建对象的过程，提高运行速度。</p><p>享元模式在Java标准库中有很多应用。我们知道，包装类型如<code>Byte</code>、<code>Integer</code>都是不变类，因此，反复创建同一个值相同的包装类型是没有必要的。以<code>Integer</code>为例，如果我们通过<code>Integer.valueOf()</code>这个静态工厂方法创建<code>Integer</code>实例，当传入的<code>int</code>范围在<code>-128</code>~<code>+127</code>之间时，会直接返回缓存的<code>Integer</code>实例：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public final class Integer {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span></span>
<span class="line"><span style="color:#e1e4e8;">            return IntegerCache.cache[i + (-IntegerCache.low)];</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public final class Integer {</span></span>
<span class="line"><span style="color:#24292e;">    public static Integer valueOf(int i) {</span></span>
<span class="line"><span style="color:#24292e;">        if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span></span>
<span class="line"><span style="color:#24292e;">            return IntegerCache.cache[i + (-IntegerCache.low)];</span></span>
<span class="line"><span style="color:#24292e;">        return new Integer(i);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="结构型-代理proxy" tabindex="-1">结构型-代理Proxy <a class="header-anchor" href="#结构型-代理proxy" aria-label="Permalink to &quot;结构型-代理Proxy&quot;">​</a></h1><p>代理模式，即Proxy，它和Adapter模式很类似。Adapter用于把A接口转换为B接口，Proxy就是为了给A接口再包一层 ，最后还是A接口。</p><p>根据代理的创建时期，代理模式分为静态代理和动态代理。</p><ul><li>静态：由程序员创建代理类或特定工具自动生成源代码再对其编译，在程序运行前代理类的 .class 文件就已经存在了。</li><li>动态：在程序运行时，运用反射机制动态创建而成</li></ul><p>模式结构：</p><ol><li>抽象主题（Subject）类：通过接口或抽象类声明真实主题和代理对象实现的业务方法。</li><li>真实主题（Real Subject）类：实现了抽象主题中的具体业务，是代理对象所代表的真实对象，是最终要引用的对象。</li><li>代理（Proxy）类：提供了与真实主题相同的接口，其内部含有对真实主题的引用，它可以访问、控制或扩展真实主题的功能。</li></ol><p><img src="`+y+`" alt="代理模式的结构图"></p><p>静态代理模式代码：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">package proxy;</span></span>
<span class="line"><span style="color:#e1e4e8;">public class ProxyTest {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        Proxy proxy = new Proxy();</span></span>
<span class="line"><span style="color:#e1e4e8;">        proxy.Request();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//抽象主题</span></span>
<span class="line"><span style="color:#e1e4e8;">interface Subject {</span></span>
<span class="line"><span style="color:#e1e4e8;">    void Request();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//真实主题</span></span>
<span class="line"><span style="color:#e1e4e8;">class RealSubject implements Subject {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void Request() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;访问真实主题方法...&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//代理</span></span>
<span class="line"><span style="color:#e1e4e8;">class Proxy implements Subject {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private RealSubject realSubject;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void Request() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (realSubject == null) {</span></span>
<span class="line"><span style="color:#e1e4e8;">            realSubject = new RealSubject();</span></span>
<span class="line"><span style="color:#e1e4e8;">        }</span></span>
<span class="line"><span style="color:#e1e4e8;">        preRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">        realSubject.Request();</span></span>
<span class="line"><span style="color:#e1e4e8;">        postRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void preRequest() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;访问真实主题之前的预处理。&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void postRequest() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;访问真实主题之后的后续处理。&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">package proxy;</span></span>
<span class="line"><span style="color:#24292e;">public class ProxyTest {</span></span>
<span class="line"><span style="color:#24292e;">    public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#24292e;">        Proxy proxy = new Proxy();</span></span>
<span class="line"><span style="color:#24292e;">        proxy.Request();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//抽象主题</span></span>
<span class="line"><span style="color:#24292e;">interface Subject {</span></span>
<span class="line"><span style="color:#24292e;">    void Request();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//真实主题</span></span>
<span class="line"><span style="color:#24292e;">class RealSubject implements Subject {</span></span>
<span class="line"><span style="color:#24292e;">    public void Request() {</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;访问真实主题方法...&quot;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//代理</span></span>
<span class="line"><span style="color:#24292e;">class Proxy implements Subject {</span></span>
<span class="line"><span style="color:#24292e;">    private RealSubject realSubject;</span></span>
<span class="line"><span style="color:#24292e;">    public void Request() {</span></span>
<span class="line"><span style="color:#24292e;">        if (realSubject == null) {</span></span>
<span class="line"><span style="color:#24292e;">            realSubject = new RealSubject();</span></span>
<span class="line"><span style="color:#24292e;">        }</span></span>
<span class="line"><span style="color:#24292e;">        preRequest();</span></span>
<span class="line"><span style="color:#24292e;">        realSubject.Request();</span></span>
<span class="line"><span style="color:#24292e;">        postRequest();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public void preRequest() {</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;访问真实主题之前的预处理。&quot;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public void postRequest() {</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;访问真实主题之后的后续处理。&quot;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>当无法或不想直接引用某个对象或访问某个对象存在困难时，可以通过代理对象来间接访问。使用代理模式主要有两个目的：一是保护目标对象，二是增强目标对象。 前面分析了代理模式的结构与特点，现在来分析以下的应用场景。</p><ul><li>远程代理，这种方式通常是为了隐藏目标对象存在于不同地址空间的事实，方便客户端访问。例如，用户申请某些网盘空间时，会在用户的文件系统中建立一个虚拟的硬盘，用户访问虚拟硬盘时实际访问的是网盘空间。</li><li>虚拟代理，这种方式通常用于要创建的目标对象开销很大时。例如，下载一幅很大的图像需要很长时间，因某种计算比较复杂而短时间无法完成，这时可以先用小比例的虚拟代理替换真实的对象，消除用户对服务器慢的感觉。</li><li>安全代理，这种方式通常用于控制不同种类客户对真实对象的访问权限。</li><li>智能指引，主要用于调用目标对象时，代理附加一些额外的处理功能。例如，增加计算真实对象的引用次数的功能，这样当该对象没有被引用时，就可以自动释放它。</li><li>延迟加载，指为了提高系统的性能，延迟对目标的加载。例如，Hibernate中就存在属性的延迟加载和关联表的延时加载。</li></ul><p>静态代理存在两个缺点。</p><ol><li>真实主题与代理主题一一对应，增加真实主题也要增加代理。</li><li>设计代理以前真实主题必须事先存在，不太灵活。采用动态代理模式可以解决以上问题，如SpringAOP，其结构图如图所示。</li></ol><p><img src="`+d+`" alt="动态代理模式的结构图"></p><h1 id="行为型-责任链" tabindex="-1">行为型-责任链 <a class="header-anchor" href="#行为型-责任链" aria-label="Permalink to &quot;行为型-责任链&quot;">​</a></h1><p>例如，JavaEE的Servlet规范定义的<code>Filter</code>就是一种责任链模式，它不但允许每个<code>Filter</code>都有机会处理请求，还允许每个<code>Filter</code>决定是否将请求“放行”给下一个<code>Filter</code>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class AuditFilter implements Filter {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {</span></span>
<span class="line"><span style="color:#e1e4e8;">        log(req);</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (check(req)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">            // 放行:</span></span>
<span class="line"><span style="color:#e1e4e8;">            chain.doFilter(req, resp);</span></span>
<span class="line"><span style="color:#e1e4e8;">        } else {</span></span>
<span class="line"><span style="color:#e1e4e8;">            // 拒绝:</span></span>
<span class="line"><span style="color:#e1e4e8;">            sendError(resp);</span></span>
<span class="line"><span style="color:#e1e4e8;">        }</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class AuditFilter implements Filter {</span></span>
<span class="line"><span style="color:#24292e;">    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {</span></span>
<span class="line"><span style="color:#24292e;">        log(req);</span></span>
<span class="line"><span style="color:#24292e;">        if (check(req)) {</span></span>
<span class="line"><span style="color:#24292e;">            // 放行:</span></span>
<span class="line"><span style="color:#24292e;">            chain.doFilter(req, resp);</span></span>
<span class="line"><span style="color:#24292e;">        } else {</span></span>
<span class="line"><span style="color:#24292e;">            // 拒绝:</span></span>
<span class="line"><span style="color:#24292e;">            sendError(resp);</span></span>
<span class="line"><span style="color:#24292e;">        }</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-命令" tabindex="-1">行为型-命令 <a class="header-anchor" href="#行为型-命令" aria-label="Permalink to &quot;行为型-命令&quot;">​</a></h1><p>假设，有一个编辑器<code>TextEditor</code>，里面有许多方法，直接调用方法：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">TextEditor editor = new TextEditor();</span></span>
<span class="line"><span style="color:#e1e4e8;">editor.add(&quot;Command pattern in text editor.\\n&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">editor.copy();</span></span>
<span class="line"><span style="color:#e1e4e8;">editor.paste();</span></span>
<span class="line"><span style="color:#e1e4e8;">System.out.println(editor.getState());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">TextEditor editor = new TextEditor();</span></span>
<span class="line"><span style="color:#24292e;">editor.add(&quot;Command pattern in text editor.\\n&quot;);</span></span>
<span class="line"><span style="color:#24292e;">editor.copy();</span></span>
<span class="line"><span style="color:#24292e;">editor.paste();</span></span>
<span class="line"><span style="color:#24292e;">System.out.println(editor.getState());</span></span></code></pre></div><ol><li><p>现在改用命令模式，首先定义<code>Command</code>接口:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface Command {</span></span>
<span class="line"><span style="color:#e1e4e8;">    void execute();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface Command {</span></span>
<span class="line"><span style="color:#24292e;">    void execute();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>接着定义一个<code>CopyCommand</code>类（还有<code>PasteCommand</code>等类）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class CopyCommand implements Command {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 持有执行者对象:</span></span>
<span class="line"><span style="color:#e1e4e8;">    private TextEditor receiver;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public CopyCommand(TextEditor receiver) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.receiver = receiver;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public void execute() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        receiver.copy();</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class CopyCommand implements Command {</span></span>
<span class="line"><span style="color:#24292e;">    // 持有执行者对象:</span></span>
<span class="line"><span style="color:#24292e;">    private TextEditor receiver;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public CopyCommand(TextEditor receiver) {</span></span>
<span class="line"><span style="color:#24292e;">        this.receiver = receiver;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public void execute() {</span></span>
<span class="line"><span style="color:#24292e;">        receiver.copy();</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div></li><li><p>客户端使用</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">TextEditor editor = new TextEditor();</span></span>
<span class="line"><span style="color:#e1e4e8;">editor.add(&quot;Command pattern in text editor.\\n&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">// 执行一个CopyCommand:</span></span>
<span class="line"><span style="color:#e1e4e8;">Command copy = new CopyCommand(editor);</span></span>
<span class="line"><span style="color:#e1e4e8;">copy.execute();</span></span>
<span class="line"><span style="color:#e1e4e8;">editor.add(&quot;----\\n&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">// 执行一个PasteCommand:</span></span>
<span class="line"><span style="color:#e1e4e8;">Command paste = new PasteCommand(editor);</span></span>
<span class="line"><span style="color:#e1e4e8;">paste.execute();</span></span>
<span class="line"><span style="color:#e1e4e8;">System.out.println(editor.getState());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">TextEditor editor = new TextEditor();</span></span>
<span class="line"><span style="color:#24292e;">editor.add(&quot;Command pattern in text editor.\\n&quot;);</span></span>
<span class="line"><span style="color:#24292e;">// 执行一个CopyCommand:</span></span>
<span class="line"><span style="color:#24292e;">Command copy = new CopyCommand(editor);</span></span>
<span class="line"><span style="color:#24292e;">copy.execute();</span></span>
<span class="line"><span style="color:#24292e;">editor.add(&quot;----\\n&quot;);</span></span>
<span class="line"><span style="color:#24292e;">// 执行一个PasteCommand:</span></span>
<span class="line"><span style="color:#24292e;">Command paste = new PasteCommand(editor);</span></span>
<span class="line"><span style="color:#24292e;">paste.execute();</span></span>
<span class="line"><span style="color:#24292e;">System.out.println(editor.getState());</span></span></code></pre></div></li></ol><p>实际上，使用命令模式，增加了系统的复杂度。如果需求很简单，那么直接调用显然更直观而且更简单。如果<code>TextEditor</code>复杂到一定程度，并且需要支持Undo、Redo的功能时，就需要使用命令模式，因为我们可以给每个命令增加<code>undo()</code>。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public interface Command {</span></span>
<span class="line"><span style="color:#e1e4e8;">    void execute();</span></span>
<span class="line"><span style="color:#e1e4e8;">    void undo();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public interface Command {</span></span>
<span class="line"><span style="color:#24292e;">    void execute();</span></span>
<span class="line"><span style="color:#24292e;">    void undo();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-解释器" tabindex="-1">行为型-解释器 <a class="header-anchor" href="#行为型-解释器" aria-label="Permalink to &quot;行为型-解释器&quot;">​</a></h1><p>解释器模式（Interpreter）是一种针对特定问题设计的一种解决方案。例如，匹配字符串的时候，由于匹配条件非常灵活，使得通过代码来实现非常不灵活。因此，需要一种通用的表示方法——正则表达式来进行匹配。正则表达式就是一个字符串，但要把正则表达式解析为<strong>语法树</strong>，然后再匹配指定的字符串，就需要一个<strong>解释器</strong>。</p><p>（实现起来略微复杂，略）</p><h1 id="行为型-迭代器" tabindex="-1">行为型-迭代器 <a class="header-anchor" href="#行为型-迭代器" aria-label="Permalink to &quot;行为型-迭代器&quot;">​</a></h1><blockquote><p><em>提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。</em></p></blockquote><p>如，定义一个逆序的迭代器</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class ReverseArrayCollection&lt;T&gt; implements Iterable&lt;T&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 以数组形式持有集合:</span></span>
<span class="line"><span style="color:#e1e4e8;">    private T[] array;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public ReverseArrayCollection(T... objs) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.array = Arrays.copyOfRange(objs, 0, objs.length);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public Iterator&lt;T&gt; iterator() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return ???;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class ReverseArrayCollection&lt;T&gt; implements Iterable&lt;T&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    // 以数组形式持有集合:</span></span>
<span class="line"><span style="color:#24292e;">    private T[] array;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public ReverseArrayCollection(T... objs) {</span></span>
<span class="line"><span style="color:#24292e;">        this.array = Arrays.copyOfRange(objs, 0, objs.length);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public Iterator&lt;T&gt; iterator() {</span></span>
<span class="line"><span style="color:#24292e;">        return ???;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-中介" tabindex="-1">行为型-中介 <a class="header-anchor" href="#行为型-中介" aria-label="Permalink to &quot;行为型-中介&quot;">​</a></h1><p>中介模式（Mediator）又称调停者模式，它的目的是把多方会谈变成双方会谈，从而实现多方的松耦合。</p><p>例如，一个点餐系统：</p><p><img src="`+u+'" alt="image-20210427161157260"></p><p>当点击某个按钮，会影响别的按钮的点击状态，所以逻辑很复杂：</p><p><img src="'+E+'" alt="image-20210427161313960"></p><p>如果引入一个中介，对象之间的关系就变得简单：</p><p><img src="'+g+'" alt="image-20210427161339723"></p><h1 id="行为型-备忘录" tabindex="-1">行为型-备忘录 <a class="header-anchor" href="#行为型-备忘录" aria-label="Permalink to &quot;行为型-备忘录&quot;">​</a></h1><p>备忘录（Memento）模式的定义：在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后当需要时能将该对象恢复到原先保存的状态。该模式又叫快照模式。</p><p>模式的结构：</p><ol><li>发起人（Originator）角色：记录当前时刻的内部状态信息，提供创建备忘录和恢复备忘录数据的功能，实现其他业务功能，它可以访问备忘录里的所有信息。</li><li>备忘录（Memento）角色：负责存储发起人的内部状态，在需要的时候提供这些内部状态给发起人。</li><li>管理者（Caretaker）角色：对备忘录进行管理，提供保存与获取备忘录的功能，但其不能对备忘录的内容进行访问与修改。</li></ol><p><img src="'+b+`" alt="备忘录模式的结构图"></p><p>模式的实现：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class MementoPattern {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        Originator or = new Originator();</span></span>
<span class="line"><span style="color:#e1e4e8;">        Caretaker cr = new Caretaker();</span></span>
<span class="line"><span style="color:#e1e4e8;">        or.setState(&quot;S0&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;初始状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#e1e4e8;">        cr.setMemento(or.createMemento()); //保存状态</span></span>
<span class="line"><span style="color:#e1e4e8;">        or.setState(&quot;S1&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;新的状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#e1e4e8;">        or.restoreMemento(cr.getMemento()); //恢复状态</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(&quot;恢复状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//备忘录</span></span>
<span class="line"><span style="color:#e1e4e8;">class Memento {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private String state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public Memento(String state) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.state = state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void setState(String state) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.state = state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public String getState() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//发起人</span></span>
<span class="line"><span style="color:#e1e4e8;">class Originator {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private String state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void setState(String state) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.state = state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public String getState() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return state;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public Memento createMemento() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return new Memento(state);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void restoreMemento(Memento m) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.setState(m.getState());</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//管理者</span></span>
<span class="line"><span style="color:#e1e4e8;">class Caretaker {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private Memento memento;</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void setMemento(Memento m) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        memento = m;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    public Memento getMemento() {</span></span>
<span class="line"><span style="color:#e1e4e8;">        return memento;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class MementoPattern {</span></span>
<span class="line"><span style="color:#24292e;">    public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#24292e;">        Originator or = new Originator();</span></span>
<span class="line"><span style="color:#24292e;">        Caretaker cr = new Caretaker();</span></span>
<span class="line"><span style="color:#24292e;">        or.setState(&quot;S0&quot;);</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;初始状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#24292e;">        cr.setMemento(or.createMemento()); //保存状态</span></span>
<span class="line"><span style="color:#24292e;">        or.setState(&quot;S1&quot;);</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;新的状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#24292e;">        or.restoreMemento(cr.getMemento()); //恢复状态</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(&quot;恢复状态:&quot; + or.getState());</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//备忘录</span></span>
<span class="line"><span style="color:#24292e;">class Memento {</span></span>
<span class="line"><span style="color:#24292e;">    private String state;</span></span>
<span class="line"><span style="color:#24292e;">    public Memento(String state) {</span></span>
<span class="line"><span style="color:#24292e;">        this.state = state;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public void setState(String state) {</span></span>
<span class="line"><span style="color:#24292e;">        this.state = state;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public String getState() {</span></span>
<span class="line"><span style="color:#24292e;">        return state;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//发起人</span></span>
<span class="line"><span style="color:#24292e;">class Originator {</span></span>
<span class="line"><span style="color:#24292e;">    private String state;</span></span>
<span class="line"><span style="color:#24292e;">    public void setState(String state) {</span></span>
<span class="line"><span style="color:#24292e;">        this.state = state;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public String getState() {</span></span>
<span class="line"><span style="color:#24292e;">        return state;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public Memento createMemento() {</span></span>
<span class="line"><span style="color:#24292e;">        return new Memento(state);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public void restoreMemento(Memento m) {</span></span>
<span class="line"><span style="color:#24292e;">        this.setState(m.getState());</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//管理者</span></span>
<span class="line"><span style="color:#24292e;">class Caretaker {</span></span>
<span class="line"><span style="color:#24292e;">    private Memento memento;</span></span>
<span class="line"><span style="color:#24292e;">    public void setMemento(Memento m) {</span></span>
<span class="line"><span style="color:#24292e;">        memento = m;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    public Memento getMemento() {</span></span>
<span class="line"><span style="color:#24292e;">        return memento;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-状态" tabindex="-1">行为型-状态 <a class="header-anchor" href="#行为型-状态" aria-label="Permalink to &quot;行为型-状态&quot;">​</a></h1><blockquote><p>允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。</p></blockquote><p>状态模式的关键设计思想在于状态切换，我们引入一个<code>BotContext</code>完成状态切换：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class BotContext {</span></span>
<span class="line"><span style="color:#e1e4e8;">	private State state = new DisconnectedState();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">	public String chat(String input) {</span></span>
<span class="line"><span style="color:#e1e4e8;">		if (&quot;hello&quot;.equalsIgnoreCase(input)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">            // 收到hello切换到在线状态:</span></span>
<span class="line"><span style="color:#e1e4e8;">			state = new ConnectedState();</span></span>
<span class="line"><span style="color:#e1e4e8;">			return state.init();</span></span>
<span class="line"><span style="color:#e1e4e8;">		} else if (&quot;bye&quot;.equalsIgnoreCase(input)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">            /  收到bye切换到离线状态:</span></span>
<span class="line"><span style="color:#e1e4e8;">			state = new DisconnectedState();</span></span>
<span class="line"><span style="color:#e1e4e8;">			return state.init();</span></span>
<span class="line"><span style="color:#e1e4e8;">		}</span></span>
<span class="line"><span style="color:#e1e4e8;">		return state.reply(input);</span></span>
<span class="line"><span style="color:#e1e4e8;">	}</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class BotContext {</span></span>
<span class="line"><span style="color:#24292e;">	private State state = new DisconnectedState();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">	public String chat(String input) {</span></span>
<span class="line"><span style="color:#24292e;">		if (&quot;hello&quot;.equalsIgnoreCase(input)) {</span></span>
<span class="line"><span style="color:#24292e;">            // 收到hello切换到在线状态:</span></span>
<span class="line"><span style="color:#24292e;">			state = new ConnectedState();</span></span>
<span class="line"><span style="color:#24292e;">			return state.init();</span></span>
<span class="line"><span style="color:#24292e;">		} else if (&quot;bye&quot;.equalsIgnoreCase(input)) {</span></span>
<span class="line"><span style="color:#24292e;">            /  收到bye切换到离线状态:</span></span>
<span class="line"><span style="color:#24292e;">			state = new DisconnectedState();</span></span>
<span class="line"><span style="color:#24292e;">			return state.init();</span></span>
<span class="line"><span style="color:#24292e;">		}</span></span>
<span class="line"><span style="color:#24292e;">		return state.reply(input);</span></span>
<span class="line"><span style="color:#24292e;">	}</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>客户端：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Scanner scanner = new Scanner(System.in);</span></span>
<span class="line"><span style="color:#e1e4e8;">BotContext bot = new BotContext();</span></span>
<span class="line"><span style="color:#e1e4e8;">for (;;) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    System.out.print(&quot;&gt; &quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    String input = scanner.nextLine();</span></span>
<span class="line"><span style="color:#e1e4e8;">    String output = bot.chat(input);</span></span>
<span class="line"><span style="color:#e1e4e8;">    System.out.println(output.isEmpty() ? &quot;(no reply)&quot; : &quot;&lt; &quot; + output);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Scanner scanner = new Scanner(System.in);</span></span>
<span class="line"><span style="color:#24292e;">BotContext bot = new BotContext();</span></span>
<span class="line"><span style="color:#24292e;">for (;;) {</span></span>
<span class="line"><span style="color:#24292e;">    System.out.print(&quot;&gt; &quot;);</span></span>
<span class="line"><span style="color:#24292e;">    String input = scanner.nextLine();</span></span>
<span class="line"><span style="color:#24292e;">    String output = bot.chat(input);</span></span>
<span class="line"><span style="color:#24292e;">    System.out.println(output.isEmpty() ? &quot;(no reply)&quot; : &quot;&lt; &quot; + output);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-观察者" tabindex="-1">行为型-观察者 <a class="header-anchor" href="#行为型-观察者" aria-label="Permalink to &quot;行为型-观察者&quot;">​</a></h1><p>观察者模式（Observer）又称发布-订阅模式（Publish-Subscribe：Pub/Sub）。它是一种通知机制，让发送通知的一方（被观察方）和接收通知的一方（观察者）能彼此分离，互不影响。</p><p>例如，定义一个<code>Store</code>，可以上架<code>Product</code>，然后通知<code>Customer</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Store {</span></span>
<span class="line"><span style="color:#e1e4e8;">    private List&lt;ProductObserver&gt; observers = new ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    private Map&lt;String, Product&gt; products = new HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    // 注册观察者:</span></span>
<span class="line"><span style="color:#e1e4e8;">    public void addObserver(ProductObserver observer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        this.observers.add(observer);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    public void addNewProduct(String name, double price) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        Product p = new Product(name, price);</span></span>
<span class="line"><span style="color:#e1e4e8;">        products.put(p.getName(), p);</span></span>
<span class="line"><span style="color:#e1e4e8;">        // 通知观察者:</span></span>
<span class="line"><span style="color:#e1e4e8;">        observers.forEach(o -&gt; o.onPublished(p));</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Store {</span></span>
<span class="line"><span style="color:#24292e;">    private List&lt;ProductObserver&gt; observers = new ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    private Map&lt;String, Product&gt; products = new HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    // 注册观察者:</span></span>
<span class="line"><span style="color:#24292e;">    public void addObserver(ProductObserver observer) {</span></span>
<span class="line"><span style="color:#24292e;">        this.observers.add(observer);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    public void addNewProduct(String name, double price) {</span></span>
<span class="line"><span style="color:#24292e;">        Product p = new Product(name, price);</span></span>
<span class="line"><span style="color:#24292e;">        products.put(p.getName(), p);</span></span>
<span class="line"><span style="color:#24292e;">        // 通知观察者:</span></span>
<span class="line"><span style="color:#24292e;">        observers.forEach(o -&gt; o.onPublished(p));</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-策略" tabindex="-1">行为型-策略 <a class="header-anchor" href="#行为型-策略" aria-label="Permalink to &quot;行为型-策略&quot;">​</a></h1><p>策略模式：Strategy，是指，定义一组算法，并把其封装到一个对象中。然后在运行时，可以灵活的使用其中的一个算法。</p><p>例如，排序算法：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">public class Main {</span></span>
<span class="line"><span style="color:#e1e4e8;">    public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#e1e4e8;">        String[] array = { &quot;apple&quot;, &quot;Pear&quot;, &quot;Banana&quot;, &quot;orange&quot; };</span></span>
<span class="line"><span style="color:#e1e4e8;">        Arrays.sort(array, String::compareToIgnoreCase);  // 忽略大小写</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(Arrays.toString(array));</span></span>
<span class="line"><span style="color:#e1e4e8;">        Arrays.sort(array, (s1, s2) -&gt; -s1.compareTo(s2)); // 倒序</span></span>
<span class="line"><span style="color:#e1e4e8;">        System.out.println(Arrays.toString(array));</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">public class Main {</span></span>
<span class="line"><span style="color:#24292e;">    public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292e;">        String[] array = { &quot;apple&quot;, &quot;Pear&quot;, &quot;Banana&quot;, &quot;orange&quot; };</span></span>
<span class="line"><span style="color:#24292e;">        Arrays.sort(array, String::compareToIgnoreCase);  // 忽略大小写</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(Arrays.toString(array));</span></span>
<span class="line"><span style="color:#24292e;">        Arrays.sort(array, (s1, s2) -&gt; -s1.compareTo(s2)); // 倒序</span></span>
<span class="line"><span style="color:#24292e;">        System.out.println(Arrays.toString(array));</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h1 id="行为型-模板" tabindex="-1">行为型-模板 <a class="header-anchor" href="#行为型-模板" aria-label="Permalink to &quot;行为型-模板&quot;">​</a></h1><p>模板方法（Template Method）是一个比较简单的模式。它的主要思想是，定义一个操作的一系列步骤，对于某些暂时确定不下来的步骤，就留给子类去实现好了，这样不同的子类就可以定义出不同的步骤。</p><p>模板代码：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TemplateMethodPattern</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        AbstractClass tm </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteClass</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        tm.</span><span style="color:#B392F0;">TemplateMethod</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象类</span></span>
<span class="line"><span style="color:#F97583;">abstract</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AbstractClass</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//模板方法</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TemplateMethod</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">SpecificMethod</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">abstractMethod1</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">abstractMethod2</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//具体方法</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SpecificMethod</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;抽象类中的具体方法被调用...&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//抽象方法1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">abstract</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abstractMethod1</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//抽象方法2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">abstract</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abstractMethod2</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体子类</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteClass</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AbstractClass</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abstractMethod1</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;抽象方法1的实现被调用...&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abstractMethod2</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;抽象方法2的实现被调用...&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TemplateMethodPattern</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        AbstractClass tm </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteClass</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        tm.</span><span style="color:#6F42C1;">TemplateMethod</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象类</span></span>
<span class="line"><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AbstractClass</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//模板方法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TemplateMethod</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">SpecificMethod</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">abstractMethod1</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">abstractMethod2</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//具体方法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SpecificMethod</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;抽象类中的具体方法被调用...&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//抽象方法1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abstractMethod1</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//抽象方法2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abstractMethod2</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体子类</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteClass</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AbstractClass</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abstractMethod1</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;抽象方法1的实现被调用...&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abstractMethod2</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;抽象方法2的实现被调用...&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h1 id="行为型-访问者" tabindex="-1">行为型-访问者 <a class="header-anchor" href="#行为型-访问者" aria-label="Permalink to &quot;行为型-访问者&quot;">​</a></h1><p>在现实生活中，有些集合对象存在多种不同的元素，且每种元素也存在多种不同的访问者和处理方式。例如，公园中存在多个景点，也存在多个游客，不同的游客对同一个景点的评价可能不同； 电影或电视剧中的人物角色，不同的观众对他们的评价也不同。</p><p>这些被处理的数据元素相对稳定而访问方式多种多样的数据结构，如果用“访问者模式”来处理比较方便。访问者模式能把处理方法从数据结构中分离出来，并可以根据需要增加新的处理方法，且不用修改原来的程序代码与数据结构，这提高了程序的扩展性和灵活性。</p><p>模型的结构：</p><ol><li>抽象访问者（Visitor）角色：定义一个访问具体元素的接口，为每个具体元素类对应一个访问操作 visit() ，该操作中的参数类型标识了被访问的具体元素。</li><li>具体访问者（ConcreteVisitor）角色：实现抽象访问者角色中声明的各个访问操作，确定访问者访问一个元素时该做什么。</li><li>抽象元素（Element）角色：声明一个包含接受操作 accept() 的接口，被接受的访问者对象作为 accept() 方法的参数。</li><li>具体元素（ConcreteElement）角色：实现抽象元素角色提供的 accept() 操作，其方法体通常都是 visitor.visit(this) ，另外具体元素中可能还包含本身业务逻辑的相关操作。</li><li>对象结构（Object Structure）角色：是一个包含元素角色的容器，提供让访问者对象遍历容器中的所有元素的方法，通常由 List、Set、Map 等聚合类实现。</li></ol><p><img src="`+m+`" alt=""></p><p>模式的实现</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> java.util.</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VisitorPattern</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        ObjectStructure os </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ObjectStructure</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        os.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteElementA</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        os.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteElementB</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        Visitor visitor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteVisitorA</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        os.</span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(visitor);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;------------------------&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        visitor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteVisitorB</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        os.</span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(visitor);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象访问者</span></span>
<span class="line"><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Visitor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementA </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementB </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体访问者A类</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteVisitorA</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Visitor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementA </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;具体访问者A访问--&gt;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> element.</span><span style="color:#B392F0;">operationA</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementB </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;具体访问者A访问--&gt;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> element.</span><span style="color:#B392F0;">operationB</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体访问者B类</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteVisitorB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Visitor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementA </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;具体访问者B访问--&gt;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> element.</span><span style="color:#B392F0;">operationA</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(ConcreteElementB </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;具体访问者B访问--&gt;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> element.</span><span style="color:#B392F0;">operationB</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象元素类</span></span>
<span class="line"><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Element</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(Visitor </span><span style="color:#FFAB70;">visitor</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体元素A类</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteElementA</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Element</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(Visitor </span><span style="color:#FFAB70;">visitor</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        visitor.</span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> String </span><span style="color:#B392F0;">operationA</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;具体元素A的操作。&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体元素B类</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConcreteElementB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Element</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(Visitor </span><span style="color:#FFAB70;">visitor</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        visitor.</span><span style="color:#B392F0;">visit</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> String </span><span style="color:#B392F0;">operationB</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;具体元素B的操作。&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//对象结构角色</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ObjectStructure</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">Element</span><span style="color:#E1E4E8;">&gt; list </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> ArrayList&lt;</span><span style="color:#F97583;">Element</span><span style="color:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(Visitor </span><span style="color:#FFAB70;">visitor</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Iterator&lt;</span><span style="color:#F97583;">Element</span><span style="color:#E1E4E8;">&gt; i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> list.</span><span style="color:#B392F0;">iterator</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (i.</span><span style="color:#B392F0;">hasNext</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            ((Element) i.</span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">()).</span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">(visitor);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(Element </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        list.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(element);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">(Element </span><span style="color:#FFAB70;">element</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        list.</span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">(element);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> java.util.</span><span style="color:#005CC5;">*</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VisitorPattern</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        ObjectStructure os </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ObjectStructure</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        os.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteElementA</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        os.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteElementB</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        Visitor visitor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteVisitorA</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        os.</span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(visitor);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;------------------------&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        visitor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteVisitorB</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        os.</span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(visitor);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象访问者</span></span>
<span class="line"><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Visitor</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementA </span><span style="color:#E36209;">element</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementB </span><span style="color:#E36209;">element</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体访问者A类</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteVisitorA</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Visitor</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementA </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;具体访问者A访问--&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> element.</span><span style="color:#6F42C1;">operationA</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementB </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;具体访问者A访问--&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> element.</span><span style="color:#6F42C1;">operationB</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体访问者B类</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteVisitorB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Visitor</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementA </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;具体访问者B访问--&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> element.</span><span style="color:#6F42C1;">operationA</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(ConcreteElementB </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;具体访问者B访问--&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> element.</span><span style="color:#6F42C1;">operationB</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//抽象元素类</span></span>
<span class="line"><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Element</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(Visitor </span><span style="color:#E36209;">visitor</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体元素A类</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteElementA</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Element</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(Visitor </span><span style="color:#E36209;">visitor</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        visitor.</span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">operationA</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;具体元素A的操作。&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//具体元素B类</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConcreteElementB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Element</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(Visitor </span><span style="color:#E36209;">visitor</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        visitor.</span><span style="color:#6F42C1;">visit</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">operationB</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;具体元素B的操作。&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//对象结构角色</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ObjectStructure</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Element</span><span style="color:#24292E;">&gt; list </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;</span><span style="color:#D73A49;">Element</span><span style="color:#24292E;">&gt;();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(Visitor </span><span style="color:#E36209;">visitor</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        Iterator&lt;</span><span style="color:#D73A49;">Element</span><span style="color:#24292E;">&gt; i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> list.</span><span style="color:#6F42C1;">iterator</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (i.</span><span style="color:#6F42C1;">hasNext</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">            ((Element) i.</span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">(visitor);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(Element </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        list.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(element);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">(Element </span><span style="color:#E36209;">element</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        list.</span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">(element);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,160),F=[v];function S(q,C,k,A,B,f){return n(),a("div",null,F)}const w=s(h,[["render",S]]);export{D as __pageData,w as default};
