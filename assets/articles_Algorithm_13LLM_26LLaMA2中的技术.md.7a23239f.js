import{_ as o,o as e,c as s,k as t,a,Q as l}from"./chunks/framework.2516552c.js";const n="/assets/v2-6d18fd84363055c3668ba4be280d0eb5_1440w.23b78429.webp",Q="/assets/image-20230926120704720.b6978c50.png",r="/assets/image-20230926120735694.cf28daaa.png",T="/assets/image-20230811190103046.c3a30dfe.png",i="/assets/v2-9f1c595e549174bcb759252369d16ada_1440w.a5cbfeb9.webp",p="/assets/v2-4ac483f897898875d424584421a7bd8f_1440w.c02a055b.webp",m="/assets/v2-150a5cb6d0d37137f3408d4a498e4696_1440w.88b52e7c.webp",d="/assets/v2-3f1115a021c4201c79a5c596a8eac0ec_720w.42a8614c.webp",c="/assets/v2-1520514ff5f2c6ea2a0def6ace10bb42_1440w.974eef6a.webp",h="/assets/v2-7fe03ee3904784d2a050e112c88cfa5b_1440w.01c642df.webp",g="/assets/v2-a7a7b4ad7ce1018183e1b8eb654f3f91_1440w.5b0a46b7.webp",u="/assets/v2-c1bb7716076d16d8c42fa37030f7be89_1440w.540822da.webp",x="/assets/v2-321500705cfbef51245d9479292c0016_1440w.babb7926.webp",w="/assets/v2-405930a9ad6ecf1993760190ef6d964e_1440w.d25d6ee0.webp",f="/assets/b6f0c8d76c594858a328246c2aebe9ef.4f3a0aec.png",y="/assets/image-20230926133909560.60cd5683.png",_="/assets/640-1693022173878.d4258eb0.png",H="/assets/image-20231218115125943.e0e18d9b.png",b="/assets/v2-a229e2fa32cec2cf8f5da336a809aa7d_720w-1702877894725.5516b832.webp",L="/assets/image-20231218133950718.d5ab0939.png",M="/assets/image-20231218134035643.08c66e7d.png",k="/assets/image-20231218134811488.da45806e.png",v="/assets/v2-8e99641b87724da26ccba3b884c70faa_720w.f58fefc9.webp",V="/assets/image-20231218124948525.afd096b8.png",E="data:image/png;base64,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",Z="/assets/image-20231218124238033.01584c6e.png",A="/assets/image-20231218125153607.043f3a92.png",D="/assets/image-20231218135204869.64f9c8ba.png",P="/assets/image-20231218135440043.0dcc946c.png",q="/assets/image-20231218135937879.64e5eeaa.png",C="/assets/image-20231218112037860.360465db.png",S="/assets/image-20231218112107578.3d24dcc0.png",R="/assets/image-20231218142133465.c07e5bd7.png",F="/assets/image-20231218142856064.cb3b880c.png",j="/assets/image-20231218143053310.1eed9178.png",G="/assets/image-20231218143711480.41550d00.png",B="/assets/image-20231218143930138.fd258d49.png",U="data:image/png;base64,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",N="/assets/image-20231218151440105.5d7d54c4.png",U2=JSON.parse('{"title":"模型相关数据","description":"","frontmatter":{},"headers":[],"relativePath":"articles/Algorithm/13LLM/26LLaMA2中的技术.md","filePath":"articles/Algorithm/13LLM/26LLaMA2中的技术.md","lastUpdated":null}'),z={name:"articles/Algorithm/13LLM/26LLaMA2中的技术.md"},W=l('<h1 id="模型相关数据" tabindex="-1">模型相关数据 <a class="header-anchor" href="#模型相关数据" aria-label="Permalink to &quot;模型相关数据&quot;">​</a></h1><h2 id="分词" tabindex="-1">分词 <a class="header-anchor" href="#分词" aria-label="Permalink to &quot;分词&quot;">​</a></h2><p>我们使用与Llama 1相同的分词器；它采用了一个字节对编码（bytepair encoding，BPE）算法（Sennrich等，2016），使用来自SentencePiece（Kudo和Richardson，2018）的实现。与Llama 1一样，我们将所有数字（number）拆分为单个数字（digit），并使用字节来分解未知的UTF-8字符。总词汇量为32k个Token。</p><h2 id="超参数" tabindex="-1">超参数 <a class="header-anchor" href="#超参数" aria-label="Permalink to &quot;超参数&quot;">​</a></h2><p>我们使用AdamW优化器（Loshchilov和Hutter，2017）进行训练，其中β1 = 0.9，β2 = 0.95，eps = 10e−5。我们使用余弦学习率计划（cosine learning rate schedule），2000步warmup，并将最终学习率衰减到峰值学习率的10％。我们使用0.1的权重衰减（weight decay）和1.0的梯度裁剪（gradient clipping）。图3显示了使用这些超参数的Llama 2的训练损失。</p><p>学习率：70B和34B是 1.5e-5, 7B和13B是3e-5</p><h2 id="硬件和时间" tabindex="-1">硬件和时间 <a class="header-anchor" href="#硬件和时间" aria-label="Permalink to &quot;硬件和时间&quot;">​</a></h2><p>论文中没准确说明，只是说70B模型训练GPU Hours是1720320 ，显卡是A100s</p><p>推测：1720320 / 24小时 / 2000张GPU = 35天</p><h2 id="训练数据" tabindex="-1">训练数据 <a class="header-anchor" href="#训练数据" aria-label="Permalink to &quot;训练数据&quot;">​</a></h2><p>比LLama1多40%。7B,13B,70B都是用了2T的Token。上下文4K。</p><h2 id="模型架构" tabindex="-1">模型架构 <a class="header-anchor" href="#模型架构" aria-label="Permalink to &quot;模型架构&quot;">​</a></h2><p>使用RMSNorm进行预归一化（Zhang和Sennrich，2019）</p><p>使用SwiGLU激活函数（Shazeer，2020）</p><p>旋转位置嵌入（rotary positional embeddings，RoPE，Su等，2022）</p><p>增加的上下文长度扩展到4K</p><p>grouped-query attention（GQA）</p><h2 id="sft" tabindex="-1">SFT <a class="header-anchor" href="#sft" aria-label="Permalink to &quot;SFT&quot;">​</a></h2><ul><li>人工标注的27540个问答对。</li></ul><ul><li>余弦学习率，初始学习率为 2×10-5，权重衰减为 0.1，批量大小为 64，序列长度为 4096 个标记。</li><li>对于微调过程，每个样本由一个提示（prompt）和一个答案（answer）组成。为了确保模型的序列长度得到正确填充，将训练集中的所有提示和答案连接在一起。使用一个特殊的 token 将提示和答案分隔开。</li><li>采用自回归目标（autoregressive objective）并将用户提示中的标记损失设为零，因此我们只在答案标记上进行反向传播。最后，我们对模型进行2个 epoch 的微调。</li></ul><h2 id="rlhf" tabindex="-1">RLHF <a class="header-anchor" href="#rlhf" aria-label="Permalink to &quot;RLHF&quot;">​</a></h2><h3 id="rlhf模型训练" tabindex="-1">RLHF模型训练 <a class="header-anchor" href="#rlhf模型训练" aria-label="Permalink to &quot;RLHF模型训练&quot;">​</a></h3><p>收集了140万二元比较数据。</p><ul><li>偏好程度：明显更好、更好、稍好、不确定。二元排序标签只有（选择，拒绝），我们的偏好被分成四个等级，因此可以更好训练奖励模型。</li><li>安全性标签：1)首选回复安全，而另一个回复不安全；2)两个回复都安全；3)两个回复都不安全</li></ul><p>单独训练了两个模型（后面说为什么）：</p><ul><li>Helpfulness RM最终在所有Meta Helpfulness数据上进行训练，与从Meta Safety和开源数据集中均匀采样的剩余数据相结合。</li><li>Safety RM在所有Meta Safety和Anthropic Harmless数据上进行训练，与Meta Helpfulness和开源Helpfulness数据以90/10的比例混合。</li></ul><p>训练细节：</p><ul><li>训练一个 epoch</li><li>使用和基础模型相同的训练超参数</li><li>70b模型使用5e-6的学习率，其他的使用1e-5学习率</li><li>3% 的 warmup</li><li>每个 batch 有 512 pairs 数据</li></ul><h3 id="rlhf迭代微调" tabindex="-1">RLHF迭代微调 <a class="header-anchor" href="#rlhf迭代微调" aria-label="Permalink to &quot;RLHF迭代微调&quot;">​</a></h3><p>尝试了两种 RLHF 微调算法:</p><ul><li><p>PPO:</p></li><li><p>拒绝采样：通过从模型中采样K个输出并选择最佳候选者，使用奖励进行重新排序，进一步使用选定的输出进行梯度更新。这种方法将获得最高奖励分数的样本视为新的标准，然后在这个新的排名样本集上进行模型的微调，加强奖励。</p></li></ul><p>对于所有的模型，我们使用AdamW优化器，其中 �1=0.9,�2=0.95,���=10−5 ，我们使用0.1的权重衰减，1.0的梯度剪裁，以及 10−6 的恒定学习率。对于每个PPO迭代，我们使用512的批量大小，0.2的PPO剪裁阈值，64的小批量大小，并在每个小批量中进行一次梯度步骤。对于7B和13B模型，我们设置β = 0.01（KL惩罚），对于34B和70B模型，我们设置β = 0.005。我们对所有模型进行200到400次迭代的训练，并使用保留的提示进行早停。每次70B模型的PPO迭代平均需要约330秒。为了使用大批量快速训练，我们使用FSDP。这在使用 �(1) 的前向或后向传递时非常有效，但在生成过程中会导致大幅度的减速（约20倍），即使使用大批量大小和KV缓存也是如此。我们通过在生成之前将模型权重合并到每个节点上，然后在生成后释放内存，恢复其余的训练循环来缓解这个问题。</p><h2 id="gatt" tabindex="-1">GAtt <a class="header-anchor" href="#gatt" aria-label="Permalink to &quot;GAtt&quot;">​</a></h2><p>解决多轮对话遗忘的问题，我们提出Ghost Attention：</p><ul><li>假设我们可以访问两个人之间的多轮对话数据集（例如，用户和助手之间的对话），其中包含一系列消息 [u1, a1, ..., un, an]，其中 un 和 an 分别对应第 n 轮对话的用户和助手消息。然后，我们定义一个指令（inst），在整个对话过程中应该被遵守。例如，指令可以是&quot;扮演&quot;某个角色。然后，我们将这个指令合成地连接到对话中所有的用户消息上</li><li>接下来，我们可以使用最新的RLHF模型从这个合成数据中进行采样。现在我们有了一个上下文对话和用于微调模型的样本，这个过程类似于拒绝抽样。然而，我们并不是在所有上下文对话回合中都加入指令，而是只在<strong>第一个回合中加入</strong>，这样会导致一个训练时的问题，即系统消息（即最后一轮之前的所有中间助手消息）与我们的样本不匹配。为了解决这个问题，以免影响训练，我们简单地将之前回合中的所有标记的损失设置为0，包括助手消息</li><li>对于训练指令，我们创建了一些合成的限制供采样，例如兴趣爱好（&quot;您喜欢（），例如网球&quot;），语言（&quot;说()，例如法语&quot;），或者公众人物（&quot;扮演()，例如拿破仑&quot;）。为了获得兴趣爱好和公众人物的列表，我们让Llama 2-Chat来生成，避免了指令与模型知识不匹配的问题（例如，让模型扮演它在训练中没有遇到过的角色）。为了使指令更加复杂和多样化，我们通过随机组合上述限制来构造最终的指令。在构造用于训练数据的最终系统消息时，我们还会将一半的原始指令修改为更简洁的形式，例如&quot;Always act as Napoleon from now&quot;会变为&quot;Figure: Napoleon&quot;。这些步骤生成了一个 SFT 数据集，用于微调Llama 2-Chat。</li></ul><h1 id="模型架构详解" tabindex="-1">模型架构详解 <a class="header-anchor" href="#模型架构详解" aria-label="Permalink to &quot;模型架构详解&quot;">​</a></h1><p>decoder-only结构</p><p><img src="'+n+'" alt="img"></p><p>模型特点：</p><ul><li>RMSNorm - 传统结构 Norm 放在 Att 后，这里将 Norm 前置</li><li>RoPE 编码 - 更换了 Position Embedding 的编码方式</li><li>MLP 层更新 - 增加了 UP 和 Donw 的线性层并使用 SiLU 激活</li><li>LLaMA-1 相比，其增加了一倍 Context Length 达到 4096</li></ul><h2 id="rmsnorm" tabindex="-1">RMSNorm <a class="header-anchor" href="#rmsnorm" aria-label="Permalink to &quot;RMSNorm&quot;">​</a></h2><p>这是在BERT、GPT等模型中广泛使用的LayerNorm：</p><p><img src="'+Q+'" alt="image-20230926120704720"></p><p><a href="https://link.zhihu.com/?target=https%3A//arxiv.org/pdf/1910.07467.pdf" target="_blank" rel="noreferrer">RMSNorm</a>(root mean square)发现LayerNorm的中心偏移没什么用(减去均值等操作)。将其去掉之后，效果几乎不变，但是速度提升了40%。最终公式为：</p><p><img src="'+r+'" alt="image-20230926120735694"></p><p>注意除了没有减均值，加偏置以外，分母上求的RMS而不是方差。</p><p>LLaMA在 Attention Layer和MLP的输入上使用了RMSNorm，相比在输出上使用，训练会更加稳定。</p><h2 id="rope" tabindex="-1">RoPE <a class="header-anchor" href="#rope" aria-label="Permalink to &quot;RoPE&quot;">​</a></h2><p>看附录。</p><h2 id="swiglu" tabindex="-1">SwiGLU <a class="header-anchor" href="#swiglu" aria-label="Permalink to &quot;SwiGLU&quot;">​</a></h2><h3 id="swish函数" tabindex="-1">Swish函数 <a class="header-anchor" href="#swish函数" aria-label="Permalink to &quot;Swish函数&quot;">​</a></h3><p><img src="'+T+'" alt="image-20230811190103046"></p><p>Swish函数可以看做是介于线性函数与ReLU函数之间的平滑函数，其中贝塔是常数或者可训练参数。</p><p><img src="'+i+'" alt="img"></p><h3 id="gelu激活函数" tabindex="-1">GELU激活函数 <a class="header-anchor" href="#gelu激活函数" aria-label="Permalink to &quot;GELU激活函数&quot;">​</a></h3><p>GELU（高斯误差线性单元）是一个非初等函数形式的激活函数，是ReLU的变种。由16年论文 <a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1606.08415" target="_blank" rel="noreferrer">Gaussian Error Linear Units (GELUs)</a> 提出，随后被GPT-2、BERT、RoBERTa、ALBERT 等NLP模型所采用。论文中不仅提出了GELU的精确形式，还给出了两个初等函数的近似形式。函数曲线如下：</p><p><img src="'+p+'" alt="img"></p><p>ReLU及其变种与Dropout从两个独立的方面来决定网络的输出，有没有什么比较中庸的方法把两者合二为一呢？在网络正则化方面，Dropout将神经单元输出随机置0（乘0），Zoneout将RNN的单元随机跳过（乘1）。两者均是将输出乘上了服从伯努利分布的随机变量m ~ Bernoulli(p)，其中p是指定的确定的参数，表示取1的概率。</p><p>然而激活函数由于在训练和测试时使用方式完全相同，所以是需要有确定性的输出，不能直接对输入x乘随机变量m，这点与Dropout不同（Dropout在测试时并不随机置0）。由于概率分布的数学期望是确定值，因此可以改为求输出的期望：E[mx]=xE[m]，即对输入乘上伯努利分布的期望值p=E[m]。</p><p>论文中希望p能够随着输入x的不同而不同，在x较小时以较大概率将其置0。 由于神经元的输入通常服从正态分布，尤其是在加入了Batch Normalization的网络中，<strong>因此令p等于正态分布的累积分布函数即可满足</strong></p><p>正态分布的累积分布函数曲线与sigmoid曲线相似。</p><p>GELU公式如下：其中erf是高斯误差函数，具体公式就不详细说了。</p>',62),I={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.308ex"},xmlns:"http://www.w3.org/2000/svg",width:"39.812ex",height:"5.344ex",role:"img",focusable:"false",viewBox:"0 -1342 17597.1 2362","aria-hidden":"true"},O=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(477,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(866,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1438,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2104.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3160.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3732.6,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(4513.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(5569.1,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(6141.1,0)"><path data-c="3A6" d="M312 622Q310 623 307 625T303 629T297 631T286 634T270 635T246 636T211 637H184V683H196Q220 680 361 680T526 683H538V637H511Q468 637 447 635T422 631T411 622V533L425 531Q525 519 595 466T665 342Q665 301 642 267T583 209T506 172T425 152L411 150V61Q417 55 421 53T447 48T511 46H538V0H526Q502 3 361 3T196 0H184V46H211Q231 46 245 46T270 47T286 48T297 51T303 54T307 57T312 61V150H310Q309 151 289 153T232 166T160 195Q149 201 136 210T103 238T69 284T56 342Q56 414 128 467T294 530Q309 532 310 533H312V622ZM170 342Q170 207 307 188H312V495H309Q301 495 282 491T231 469T186 423Q170 389 170 342ZM415 188Q487 199 519 236T551 342Q551 384 539 414T507 459T470 481T434 491T415 495H410V188H415Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(6863.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(7252.1,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(7824.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(8490.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(9546.7,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(10118.7,0)"><g data-mml-node="mn" transform="translate(220,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(220,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g><rect width="700" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(11058.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(11447.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(12169.9,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(13170.1,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(13636.1,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(14087.1,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(14637.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(15026.1,0)"><g data-mml-node="mi" transform="translate(610.5,676)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="msqrt" transform="translate(220,-920.5)"><g transform="translate(853,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(0,100.5)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z" style="stroke-width:3;"></path></g><rect width="500" height="60" x="853" y="840.5"></rect></g><rect width="1553" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(16819.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(17208.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g></g></g>',1),K=[O],X=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mi",null,"g"),t("mo",{stretchy:"false"},"("),t("mi",null,"x"),t("mo",{stretchy:"false"},")"),t("mo",null,"="),t("mi",null,"x"),t("mi",null,"p"),t("mo",null,"="),t("mi",null,"x"),t("mi",{mathvariant:"normal"},"Φ"),t("mo",{stretchy:"false"},"("),t("mi",null,"x"),t("mo",{stretchy:"false"},")"),t("mo",null,"="),t("mi",null,"x"),t("mfrac",null,[t("mn",null,"1"),t("mn",null,"2")]),t("mo",{stretchy:"false"},"("),t("mn",null,"1"),t("mo",null,"+"),t("mi",null,"e"),t("mi",null,"r"),t("mi",null,"f"),t("mo",{stretchy:"false"},"("),t("mfrac",null,[t("mi",null,"x"),t("msqrt",null,[t("mn",null,"2")])]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")")])],-1),Y=l('<p>erf(x) 与 tanh(x) 比较接近，在代码实现中可以用近似函数来拟合erf(x)。论文给出的两个近似如下：</p><p><img src="'+m+`" alt="img"></p><p>$\\sigma $代表sigmoid激活函数。不过很多框架已经有精确的erf计算函数了，可以直接使用，参考代码如下：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># BERT、GPT-2 的旧式 GELU 实现</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">gelu</span><span style="color:#E1E4E8;">(x):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.5</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tf.tanh(np.sqrt(</span><span style="color:#79B8FF;">2</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">np.pi)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(x</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0.044715</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">tf.pow(x,</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">))))</span></span>
<span class="line"><span style="color:#6A737D;"># 使用erf函数的 GELU 实现</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">gelu</span><span style="color:#E1E4E8;">(x):</span></span>
<span class="line"><span style="color:#E1E4E8;">    cdf </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.5</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tf.erf(x </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> tf.sqrt(</span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;">)))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> cdf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># BERT、GPT-2 的旧式 GELU 实现</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">gelu</span><span style="color:#24292E;">(x):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tf.tanh(np.sqrt(</span><span style="color:#005CC5;">2</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">np.pi)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(x</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0.044715</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">tf.pow(x,</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">))))</span></span>
<span class="line"><span style="color:#6A737D;"># 使用erf函数的 GELU 实现</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">gelu</span><span style="color:#24292E;">(x):</span></span>
<span class="line"><span style="color:#24292E;">    cdf </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tf.erf(x </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> tf.sqrt(</span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;">)))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> cdf</span></span></code></pre></div><p><img src="`+d+'" alt="img"></p><p>可以看出，当x越大的时候，就越有可能被保留，x越小就越有可能被归置为0.</p><p><strong>GELU vs Swish</strong></p><p>GELU 与 Swish 激活函数（x · σ(βx)）的函数形式和性质非常相像，一个是固定系数 1.702，另一个是可变系数 β（可以是可训练的参数，也可以是通过搜索来确定的常数），两者的实际应用表现也相差不大。</p><h3 id="glu-gated-linear-unit" tabindex="-1">GLU（Gated Linear Unit) <a class="header-anchor" href="#glu-gated-linear-unit" aria-label="Permalink to &quot;GLU（Gated Linear Unit)&quot;">​</a></h3><p><img src="'+c+'" alt="img"></p><p>圆圈代表哈达玛积 / 点乘 / 按位乘</p><p>在公式中，首先通过中间向量g(x)=xW进行门控操作，使用Sigmoid函数σ将其映射到0到1之间的范围，表示每个元素被保留的概率。然后，将输入向量x与门控后的向量进行逐元素相乘（即 ⊗ 操作），得到最终的输出向量。</p><p>GLU通过门控机制对输出进行把控，像Attention一样可看作是对重要特征的选择。其优势是不仅具有通用激活函数的非线性，而且<strong>反向传播梯度时具有线性通道</strong>，类似ResNet残差网络中的加和操作传递梯度，能够缓解梯度消失问题。</p><h3 id="geglu" tabindex="-1">GEGLU <a class="header-anchor" href="#geglu" aria-label="Permalink to &quot;GEGLU&quot;">​</a></h3><p>是GLU的激活函数变体</p><p>将GLU中的sigmoid替换为GELU，函数形式如下（忽略bias项的书写）：</p><p><img src="'+h+'" alt="img"></p><p>GLU包含W和V两个可学习的参数</p><p>GEGLU也包含W和V两个可学习的参数，用GELU替换SIGMOD</p><h3 id="swiglu-1" tabindex="-1">SwiGLU <a class="header-anchor" href="#swiglu-1" aria-label="Permalink to &quot;SwiGLU&quot;">​</a></h3><p><img src="'+g+'" alt="img"></p><p>在FFN中，即FC-&gt;激活函数-&gt;FC中，ReLU一般定义如下：</p><p><img src="'+u+'" alt="img"></p><p>在T5论文中没有使用偏置项，也就是：</p><p><img src="'+x+'" alt="img"></p><p>在PaLM论文中使用了SwiGLU激活函数：</p><p><img src="'+w+'" alt="img"></p><h3 id="silu" tabindex="-1">SiLU <a class="header-anchor" href="#silu" aria-label="Permalink to &quot;SiLU&quot;">​</a></h3><p>当beta=1是，swish函数就是xsigmoid(x)，SiLU函数就是Swish(xW) \\dot V</p><h2 id="mlp" tabindex="-1">MLP <a class="header-anchor" href="#mlp" aria-label="Permalink to &quot;MLP&quot;">​</a></h2><p><img src="'+f+'" alt="img"></p><p>这里 MLP 的表达式为：</p><p><img src="'+y+'" alt="image-20230926133909560"></p><p>其中 up、down 与 gate 是三个维度相同的 Linear 层。</p><h2 id="gqa-v2-only" tabindex="-1">GQA（v2 only） <a class="header-anchor" href="#gqa-v2-only" aria-label="Permalink to &quot;GQA（v2 only）&quot;">​</a></h2><p>参考：<a href="https://mp.weixin.qq.com/s/wOyDpxcxKATxGrP8W-1w2Q" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/s/wOyDpxcxKATxGrP8W-1w2Q</a></p><h3 id="kv-cache" tabindex="-1">KV Cache <a class="header-anchor" href="#kv-cache" aria-label="Permalink to &quot;KV Cache&quot;">​</a></h3><p>Decoder 每次前向，当前 timestep 计算 Attention 要用到的部分，如之前 timestep 的 KV （Key 和 Value）值都计算过的，只是之前每次前向完后给计算结果都丢掉，只保留最后输出。</p><p>于是一个很自然的想法就是 <strong>Cache</strong>。这很像斐波那契递归函数，naive 版本，也会出现不断重复计算问题，加个 cache 瞬间提速。</p><p>每次前向完，给 <strong>KV 都保留下来，用于之后计算</strong>。</p><p>瓶颈：SRAM内存昂贵且有限；而GPU显存DRAM有<strong>内存墙</strong>问题，即内存读取速度限制了整体速度。</p><h3 id="mqa-和-gqa" tabindex="-1">MQA 和 GQA <a class="header-anchor" href="#mqa-和-gqa" aria-label="Permalink to &quot;MQA 和 GQA&quot;">​</a></h3><p><strong>MHA(Multi-Head Attention)</strong>，QKV 三部分有相同数量的头，且一一对应。</p><p><strong>MQA(Multi-Query Attention)</strong> 则是让 <strong>Q 仍然保持原来的头数</strong>，但 <strong>K 和 V 只有一个头</strong>，相当于所有的 Q 头共享一组 K 和 V 头，所以叫做 Multi-Query 了。实现改变了会不会影响效果呢？确实会影响但相对它能带来的收益，性能的些微降低是可以接受的。能带来多大的收益呢，实验发现一般能<strong>提高 30%-40% 的吞吐</strong>。收益主要就是由降低了 KV cache 带来的，实际上 MQA 运算量和 MHA 是差不多的。</p><p><strong>GQA(Group-Query Attention)</strong> 是 MHA 和 MQA 的折衷方案，既不想损失性能太多，又想获得 MQA 带来的推理加速好处。具体思想是，不是所有 Q 头共享一组 KV，而是<strong>分组一定头数 Q 共享一组 KV</strong>，比如上面图片就是两组 Q 共享一组 KV。</p><p><img src="'+_+'" alt="图片"></p><h1 id="附-复数" tabindex="-1">附：复数 <a class="header-anchor" href="#附-复数" aria-label="Permalink to &quot;附：复数&quot;">​</a></h1><p><strong>极坐标系</strong></p><p>用角度和长度描述位置的坐标系</p><p><img src="'+H+'" alt="image-20231218115125943"></p>',50),$={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},t1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},a1=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1),e1=[a1],s1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"θ")])],-1),l1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},o1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},n1=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1),Q1=[n1],r1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"θ")])],-1),T1=t("p",null,[t("strong",null,"极坐标与直角坐标转换")],-1),i1=t("p",null,[t("img",{src:b,alt:"img"})],-1),p1=t("p",null,"极坐标转换为直角坐标：",-1),m1=t("p",null,[t("img",{src:L,alt:"image-20231218133950718"})],-1),d1=t("p",null,"直角坐标转极坐标：",-1),c1=t("p",null,[t("img",{src:M,alt:"image-20231218134035643"})],-1),h1=t("p",null,[t("strong",null,"复数")],-1),g1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.677ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 3393.1 915.9","aria-hidden":"true"},x1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(378,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(1059.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2115.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(2893.1,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g></g>',1),w1=[x1],f1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mi",null,"i"),t("mn",null,"2")]),t("mo",null,"="),t("mo",null,"−"),t("mn",null,"1")])],-1),y1=t("p",null,[t("strong",null,"复数的共轭")],-1),_1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.564ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.423ex",height:"2.751ex",role:"img",focusable:"false",viewBox:"0 -966.5 6817.1 1216","aria-hidden":"true"},b1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(278,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(556,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1021,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1299,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1854.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="msqrt" transform="translate(2910.6,0)"><g transform="translate(853,0)"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(562,289) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(1187.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(2188,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(462,289) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(0,106.5)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z" style="stroke-width:3;"></path></g><rect width="3053.6" height="60" x="853" y="846.5"></rect></g></g></g>',1),L1=[b1],M1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mi",null,"z"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",null,"="),t("msqrt",null,[t("msup",null,[t("mi",null,"a"),t("mn",null,"2")]),t("mo",null,"+"),t("msup",null,[t("mi",null,"b"),t("mn",null,"2")])])])],-1),k1=t("blockquote",null,[t("p",null,"「共轭」是数学中一个比较有逼格的词。「轭」是牛拉车用的木头，同时拉一辆车的两头牛，就是「共轭」关系。把这种关系引申到数学中，只要是成对的东西，又找不着一个更合适的叫法时，就常常称它们为「共轭」，这个「轭」并不总能找到相应的数学概念。")],-1),v1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.783ex",height:"1.756ex",role:"img",focusable:"false",viewBox:"0 -694 4324 776","aria-hidden":"true"},E1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mover"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(288.1,3) translate(-250 0)"><path data-c="AF" d="M69 544V590H430V544H69Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(742.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1798.6,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2549.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3550,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3979,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g>',1),Z1=[E1],A1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mrow",{"data-mjx-texclass":"ORD"},[t("mover",null,[t("mi",null,"z"),t("mo",{stretchy:"false"},"¯")])]),t("mo",null,"="),t("mi",null,"a"),t("mo",null,"−"),t("mi",null,"b"),t("mi",null,"i")])],-1),D1=t("p",null,[t("strong",null,"复数的几何意义")],-1),P1=t("p",null,"考虑一个二维笛卡尔坐标系上的一个半径为R的圆。这个坐标系的x轴为实轴，y坐标为虚轴。",-1),q1=t("p",null,[t("img",{src:k,alt:"image-20231218134811488"})],-1),C1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.448ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 640 453","aria-hidden":"true"},R1=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FC",d:"M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z",style:{"stroke-width":"3"}})])])],-1),F1=[R1],j1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"α")])],-1),G1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.235ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2313.7 1000","aria-hidden":"true"},U1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(840,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1284.7,0)"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1924.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g></g></g>',1),N1=[U1],z1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",{stretchy:"false"},"("),t("mi",null,"r"),t("mo",null,","),t("mi",null,"α"),t("mo",{stretchy:"false"},")")])],-1),W1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},I1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"14.821ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 6550.7 1000","aria-hidden":"true"},J1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(840,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1273,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1758,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(2227,0)"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2867,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3311.7,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3762.7,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(4107.7,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(4576.7,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(4921.7,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(5521.7,0)"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(6161.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g></g></g>',1),O1=[J1],K1=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",{stretchy:"false"},"("),t("mi",null,"r"),t("mi",null,"c"),t("mi",null,"o"),t("mi",null,"s"),t("mi",null,"α"),t("mo",null,","),t("mi",null,"r"),t("mi",null,"i"),t("mi",null,"s"),t("mi",null,"i"),t("mi",null,"n"),t("mi",null,"α"),t("mo",{stretchy:"false"},")")])],-1),X1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Y1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.564ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.461ex",height:"2.751ex",role:"img",focusable:"false",viewBox:"0 -966.5 8601.7 1216","aria-hidden":"true"},$1=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(728.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1784.6,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2062.6,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(2340.6,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2805.6,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3083.6,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3639.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="msqrt" transform="translate(4695.1,0)"><g transform="translate(853,0)"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(562,289) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(1187.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(2188,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(462,289) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(0,106.5)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z" style="stroke-width:3;"></path></g><rect width="3053.6" height="60" x="853" y="846.5"></rect></g></g></g>',1),t2=[$1],a2=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"r"),t("mo",null,"="),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mi",null,"z"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",null,"="),t("msqrt",null,[t("msup",null,[t("mi",null,"a"),t("mn",null,"2")]),t("mo",null,"+"),t("msup",null,[t("mi",null,"b"),t("mn",null,"2")])])])],-1),e2=l('<p>已知欧拉公式是：</p><p><img src="'+v+'" alt="img"></p><p>根据欧拉公式和共轭性质，可以推出：</p><p><img src="'+V+'" alt="image-20231218124948525"></p><p>所以，对于任意一个复数z=a+bi，可以表示为：</p><p><img src="'+E+'" alt="image-20231218125032487"></p><p>根据矩阵乘法</p><p><img src="'+Z+'" alt="image-20231218124238033"></p><p>对于欧拉公式的表示法，乘法是一样的：</p><p><img src="'+A+'" alt="image-20231218125153607"></p><p>从欧拉公式的表示下很容易得出复数乘法的几何意义，相乘之后还是一个复数，这个复数的模长是z1z2，与x轴夹角是他们两个之和。</p><p><strong>复数的向量表示</strong></p><p><img src="'+D+'" alt="image-20231218135204869"></p><p><strong>复数的矩阵表示</strong></p><p><img src="'+P+'" alt="image-20231218135440043"></p>',15),s2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},l2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},o2=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1),n2=[o2],Q2=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"θ")])],-1),r2=t("p",null,[t("img",{src:q,alt:"image-20231218135937879"})],-1),T2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.564ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.568ex",height:"2.26ex",role:"img",focusable:"false",viewBox:"0 -749.5 1577 999","aria-hidden":"true"},p2=l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(278,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(556,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1021,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1299,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z" style="stroke-width:3;"></path></g></g></g>',1),m2=[p2],d2=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mi",null,"z"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),t("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|")])],-1),c2=l('<h1 id="附-pope" tabindex="-1">附：PoPE <a class="header-anchor" href="#附-pope" aria-label="Permalink to &quot;附：PoPE&quot;">​</a></h1><blockquote><p>RoPE是目前唯一一种可以用于线性Attention的相对位置编码。</p></blockquote><p>m,n表示位置，我们希望：（因为attention计算有乘法）</p><p><img src="'+C+'" alt="image-20231218112037860"></p><p>但是，乘法有交换律，这是我们不希望得到的：</p><p><img src="'+S+'" alt="image-20231218112107578"></p><p>乘法有交换律，怎么解决：</p><ul><li>矩阵乘法不存在交换律；</li><li>复数乘法有类似的公式，且满足交换律。</li></ul><p>用Re[]表示复数的实部，用复数推理，有：</p><p><img src="'+R+'" alt="image-20231218142133465"></p><p>我们要计算q,k的注意力，我们希望q,k的实数部分与m,n无关，虚数部分用上面公式计算。所以有：</p><p><img src="'+F+'" alt="image-20231218142856064"></p>',12),h2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},g2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},u2=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1),x2=[u2],w2=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"θ")])],-1),f2=t("p",null,"根据复数乘法的几何意义，该变换实际上对应着向量的旋转，所以我们称之为“旋转式位置编码”，它还可以写成矩阵形式：",-1),y2=t("p",null,[t("img",{src:j,alt:"image-20231218143053310"})],-1),_2=t("p",null,"由于内积满足线性叠加性，因此任意偶数维的RoPE，我们都可以表示为二维情形的拼接，即",-1),H2=t("blockquote",null,[t("p",null,"向量的线性叠加性指：内积的顺序不影响结果。我理解q和v要做内积，再加上位置编码不影响。")],-1),b2=t("p",null,[t("img",{src:G,alt:"image-20231218143711480"})],-1),L2=t("p",null,"Q和V矩阵计算完成后，Attention就自动包含相对位置信息。",-1),M2=t("p",null,"由于Rm矩阵的稀疏性，所以直接用矩阵乘法来实现会很浪费算力，推荐通过下述方式来实现RoPE：",-1),k2=t("p",null,[t("img",{src:B,alt:"image-20231218143930138"})],-1),v2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},E2=t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1),Z2=[E2],A2=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"θ")])],-1),D2=t("p",null,[t("img",{src:U,alt:"image-20231218145130325"})],-1),P2=t("p",null,[t("img",{src:N,alt:"image-20231218151440105"})],-1);function q2(C2,S2,R2,F2,j2,G2){return e(),s("div",null,[W,t("mjx-container",I,[(e(),s("svg",J,K)),X]),Y,t("p",null,[a("只有一条射线轴，叫极轴。O是极点。r是极径。"),t("mjx-container",$,[(e(),s("svg",t1,e1)),s1]),a("是极角。")]),t("p",null,[a("有了上述三个要素，空间中任意一点都可以用序对 (r, "),t("mjx-container",l1,[(e(),s("svg",o1,Q1)),r1]),a(" ) 表示。")]),T1,i1,p1,m1,d1,c1,h1,t("p",null,[a("定义复数z=a+bi，其中a是实部，b是虚部，i是虚数单位，"),t("mjx-container",g1,[(e(),s("svg",u1,w1)),f1]),a(" 。")]),y1,t("p",null,[a("复数的模是："),t("mjx-container",_1,[(e(),s("svg",H1,L1)),M1])]),k1,t("p",null,[a("假如有复数z=a+bi, 那么它的共轭是"),t("mjx-container",v1,[(e(),s("svg",V1,Z1)),A1]),a(" 。他们的模的平方相等。")]),D1,P1,q1,t("p",null,[a("有夹角"),t("mjx-container",C1,[(e(),s("svg",S1,F1)),j1]),a("，")]),t("p",null,[a("极坐标表示为"),t("mjx-container",G1,[(e(),s("svg",B1,N1)),z1]),a(" ，")]),t("p",null,[a("复平面坐标为"),t("mjx-container",W1,[(e(),s("svg",I1,O1)),K1]),a(" ，")]),t("p",null,[a("模长为"),t("mjx-container",X1,[(e(),s("svg",Y1,t2)),a2]),a(" ，")]),e2,t("p",null,[a("假设复平面内，复数与实轴夹角为"),t("mjx-container",s2,[(e(),s("svg",l2,n2)),Q2]),a(" :")]),r2,t("p",null,[a("所以，复数表示空间逆时针旋转90度，缩放"),t("mjx-container",T2,[(e(),s("svg",i2,m2)),d2]),a("倍。")]),c2,t("p",null,[a("上式m是位置，"),t("mjx-container",h2,[(e(),s("svg",g2,x2)),w2]),a("是超参数，可以理解为位置编码旋转的角度。")]),f2,y2,_2,H2,b2,L2,M2,k2,t("p",null,[a("最后，"),t("mjx-container",v2,[(e(),s("svg",V2,Z2)),A2]),a("作者沿用了Sinusoidal位置编码的方案，它可以带来一定的远程衰减性。")]),D2,P2])}const N2=o(z,[["render",q2]]);export{U2 as __pageData,N2 as default};
